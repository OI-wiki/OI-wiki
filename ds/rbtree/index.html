<!doctype html><html class=no-js lang=zh-Hans><meta charset=utf-8><meta content=on http-equiv=x-dns-prefetch-control><link href=//oi-wiki.org rel=dns-prefetch><link href=//search.oi-wiki.org rel=dns-prefetch><link href=//api.github.com rel=dns-prefetch><link href=//www.google-analytics.com rel=dns-prefetch><meta content="width=device-width,initial-scale=1" name=viewport><meta content="OI Wiki 是一个编程竞赛知识整合站点，提供有趣又实用的编程竞赛知识以及其他有帮助的内容，帮助广大编程竞赛爱好者更快更深入地学习编程竞赛" name=description><meta content="0x03A6, abc1763613206, auuuu4, CCXXXI, Conless, Enter-tainer, fanenr, happyZYM, hsfzLZH1, iamtwz, LeverImmy, leverimmy, Lhcfl, Marcythm, RIvance, Tiphereth-A, trudbot, Xeniume, Xeonacid, YBYCS, yuhuoji" name=author><link href=https://oi-wiki.org/ds/rbtree/ rel=canonical><link href=../avl/ rel=prev><link href=../llrbt/ rel=next><link href=../../favicon.ico rel=icon><meta content="mkdocs-1.5.3, mkdocs-material-9.6.15" name=generator><title>红黑树 - OI Wiki</title><link href=../../assets/stylesheets/main.bd3167ff.min.css rel=stylesheet><link href=../../assets/stylesheets/palette.06af60db.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Mono"}@font-face{font-family:Fira Sans;font-style:normal;font-weight:300;src:url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.eot);src:local(Fira Sans),local(FiraSans-Normal),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.eot?#iefix)format("embedded-opentype"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.woff2)format("woff2"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.woff)format("woff"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.ttf)format("truetype"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.svg#FiraSans)format("svg")}@font-face{font-family:Fira Sans;font-style:normal;font-weight:regular;src:url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.eot);src:local(Fira Sans),local(FiraSans-Normal),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.eot?#iefix)format("embedded-opentype"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.woff2)format("woff2"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.woff)format("woff"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.ttf)format("truetype"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.svg#FiraSans)format("svg")}@font-face{font-family:Fira Sans;font-style:italic;font-weight:regular;src:url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.eot);src:local(Fira Sans),local(FiraSans-Italic),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.eot?#iefix)format("embedded-opentype"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.woff2)format("woff2"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.woff)format("woff"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.ttf)format("truetype"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.svg#FiraSans)format("svg")}@font-face{font-family:Fira Sans;font-style:normal;font-weight:700;src:url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.eot);src:local(Fira Sans),local(FiraSans-Normal),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.eot?#iefix)format("embedded-opentype"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.woff2)format("woff2"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.woff)format("woff"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.ttf)format("truetype"),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.svg#FiraSans)format("svg")}@font-face{font-family:Fira Mono;font-style:normal;font-weight:regular;src:url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.eot);src:local(Fira Mono),local(FiraMono-Normal),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.eot?#iefix)format("embedded-opentype"),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.woff2)format("woff2"),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.woff)format("woff"),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.ttf)format("truetype"),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.svg#FiraMono)format("svg")}</style><link href="../../_static/css/extra.css?v=16" rel=stylesheet><link href="../../assets/stylesheets/oiwiki-feedback-sys-frontend.css?v=202763fcae134a48bc639c9f3cde9d46" rel=stylesheet><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","UA-124485594-1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","UA-124485594-1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=UA-124485594-1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><script src=../../assets/javascripts/toggle-sidebar.js></script><link href="../../assets/stylesheets/mathjax.css?hash=3b97f50827c49ac9c18bf068907fb9c8f7c03fea7566ddb8026d26336f0ef684" rel=stylesheet></head><body data-md-color-accent=red data-md-color-primary=white data-md-color-scheme=default dir=ltr><input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox><input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox><label class=md-overlay for=__drawer></label><div data-md-component=skip><a class=md-skip href=#性质> 跳转至 </a></div><div data-md-component=announce></div><header class=md-header data-md-component=header><nav class="md-header__inner md-grid" aria-label=页眉><a aria-label="OI Wiki" class="md-header__button md-logo" title="OI Wiki" data-md-component=logo href=../..> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17z"></path></svg> </a><label class="md-header__button md-icon" for=__drawer><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> OI Wiki </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> 红黑树 </span></div></div></div><form class=md-header__option data-md-component=palette><input aria-label="Switch to dark mode" data-md-color-media="(prefers-color-scheme: light)" class=md-option data-md-color-accent=red data-md-color-primary=white data-md-color-scheme=default id=__palette_0 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg></label><input aria-label="Switch to light mode" data-md-color-media="(prefers-color-scheme: dark)" class=md-option data-md-color-accent=blue data-md-color-primary=blue data-md-color-scheme=slate id=__palette_1 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg></label></form><script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script><label class="md-header__button md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input aria-label=搜索 autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=搜索 required spellcheck=false><label class="md-search__icon md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg></label><nav aria-label=查找 class=md-search__options><button class="md-search__icon md-icon" aria-label=清空当前内容 tabindex=-1 title=清空当前内容 type=reset><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button></nav></form><div class=md-search__output><div class=md-search__scrollwrap data-md-scrollfix tabindex=0><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta>正在初始化搜索引擎</div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a class=md-source data-md-component=source href=https://github.com/OI-wiki/OI-wiki target=_blank title=前往仓库> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg></div> <div class=md-source__repository>OI-wiki/OI-wiki</div> </a></div></nav></header><div class=md-container data-md-component=container><nav aria-label=标签 class=md-tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a class=md-tabs__link href=../..> 简介 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../contest/> 比赛相关 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../tools/> 工具软件 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../lang/> 语言基础 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../basic/> 算法基础 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../search/> 搜索 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../dp/> 动态规划 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../string/> 字符串 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../math/> 数学 </a></li><li class="md-tabs__item md-tabs__item--active"><a class=md-tabs__link href=../> 数据结构 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../graph/> 图论 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../geometry/> 计算几何 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../misc/> 杂项 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../topic/rmq/> 专题 </a></li></ul></div></nav><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0><label class=md-nav__title for=__drawer><a aria-label="OI Wiki" class="md-nav__button md-logo" title="OI Wiki" data-md-component=logo href=../..> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17z"></path></svg> </a> OI Wiki</label><div class=md-nav__source><a class=md-source data-md-component=source href=https://github.com/OI-wiki/OI-wiki target=_blank title=前往仓库> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg></div> <div class=md-source__repository>OI-wiki/OI-wiki</div> </a></div><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_1 type=checkbox> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0><span class=md-ellipsis> 简介 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_1_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_1><span class="md-nav__icon md-icon"></span> 简介</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../..> <span class=md-ellipsis> Getting Started </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/about/> <span class=md-ellipsis> 关于本项目 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/htc/> <span class=md-ellipsis> 如何参与 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/what-oi-wiki-is-not/> <span class=md-ellipsis> OI Wiki 不是什么 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/format/> <span class=md-ellipsis> 格式手册 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/symbol/> <span class=md-ellipsis> 数学符号表 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/faq/> <span class=md-ellipsis> F.A.Q. </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/mirrors/> <span class=md-ellipsis> 镜像站列表 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/thanks/> <span class=md-ellipsis> 致谢 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_2 type=checkbox> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0><span class=md-ellipsis> 比赛相关 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_2_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_2><span class="md-nav__icon md-icon"></span> 比赛相关</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../contest/> <span class=md-ellipsis> 比赛相关简介 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_2_2 type=checkbox> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0><span class=md-ellipsis> 赛事 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_2_2_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_2_2><span class="md-nav__icon md-icon"></span> 赛事</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../contest/oi/> <span class=md-ellipsis> OI 赛事与赛制 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../contest/icpc/> <span class=md-ellipsis> ICPC/CCPC 赛事与赛制 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_2_3 type=checkbox> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0><span class=md-ellipsis> 题型 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_2_3_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_2_3><span class="md-nav__icon md-icon"></span> 题型</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../contest/problems/> <span class=md-ellipsis> 题型概述 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../contest/interaction/> <span class=md-ellipsis> 交互题 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../contest/roadmap/> <span class=md-ellipsis> 学习路线 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../contest/resources/> <span class=md-ellipsis> 学习资源 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_2_6 type=checkbox> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0><span class=md-ellipsis> 技巧 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_2_6_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_2_6><span class="md-nav__icon md-icon"></span> 技巧</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../contest/io/> <span class=md-ellipsis> 读入、输出优化 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../contest/dictionary/> <span class=md-ellipsis> 分段打表 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../contest/common-mistakes/> <span class=md-ellipsis> 常见错误 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../contest/common-tricks/> <span class=md-ellipsis> 常见技巧 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../contest/problemsetting/> <span class=md-ellipsis> 出题 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_3 type=checkbox> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0><span class=md-ellipsis> 工具软件 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_3_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_3><span class="md-nav__icon md-icon"></span> 工具软件</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../tools/> <span class=md-ellipsis> 工具软件简介 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_3_2 type=checkbox> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0><span class=md-ellipsis> 代码编辑工具 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_3_2_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_3_2><span class="md-nav__icon md-icon"></span> 代码编辑工具</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/vim/> <span class=md-ellipsis> Vim </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/emacs/> <span class=md-ellipsis> Emacs </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/vscode/> <span class=md-ellipsis> VS Code </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/atom/> <span class=md-ellipsis> Atom </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/eclipse/> <span class=md-ellipsis> Eclipse </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/npp/> <span class=md-ellipsis> Notepad++ </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/kate/> <span class=md-ellipsis> Kate </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/devcpp/> <span class=md-ellipsis> Dev-C++ </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/clion/> <span class=md-ellipsis> CLion </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/geany/> <span class=md-ellipsis> Geany </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/xcode/> <span class=md-ellipsis> Xcode </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/guide/> <span class=md-ellipsis> GUIDE </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/sublime/> <span class=md-ellipsis> Sublime Text </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/cpeditor/> <span class=md-ellipsis> CP Editor </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/codeblocks/> <span class=md-ellipsis> Code::Blocks </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_3_3 type=checkbox> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0><span class=md-ellipsis> 评测工具 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_3_3_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_3_3><span class="md-nav__icon md-icon"></span> 评测工具</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../tools/judger/> <span class=md-ellipsis> 评测工具简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/judger/arbiter/> <span class=md-ellipsis> Arbiter </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/judger/cena/> <span class=md-ellipsis> Cena </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/judger/ccr-plus/> <span class=md-ellipsis> CCR Plus </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/judger/lemon/> <span class=md-ellipsis> Lemon </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../tools/cmd/> <span class=md-ellipsis> 命令行 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/compile-debug/> <span class=md-ellipsis> 命令行编译与调试 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/compiler/> <span class=md-ellipsis> 编译器 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/wsl/> <span class=md-ellipsis> WSL (Windows 10) </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/special-judge/> <span class=md-ellipsis> Special Judge </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_3_9 type=checkbox> <label class=md-nav__link for=__nav_3_9 id=__nav_3_9_label tabindex=0><span class=md-ellipsis> Testlib </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_3_9_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_3_9><span class="md-nav__icon md-icon"></span> Testlib</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../tools/testlib/> <span class=md-ellipsis> Testlib 简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/testlib/general/> <span class=md-ellipsis> 通用 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/testlib/generator/> <span class=md-ellipsis> Generator </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/testlib/validator/> <span class=md-ellipsis> Validator </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/testlib/interactor/> <span class=md-ellipsis> Interactor </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/testlib/checker/> <span class=md-ellipsis> Checker </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../tools/polygon/> <span class=md-ellipsis> Polygon </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/oj-tool/> <span class=md-ellipsis> OJ 工具 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/latex/> <span class=md-ellipsis> LaTeX 入门 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/git/> <span class=md-ellipsis> Git </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_4 type=checkbox> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0><span class=md-ellipsis> 语言基础 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_4_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_4><span class="md-nav__icon md-icon"></span> 语言基础</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/> <span class=md-ellipsis> 语言基础简介 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_4_2 type=checkbox> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0><span class=md-ellipsis> C++ 基础 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_4_2_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_4_2><span class="md-nav__icon md-icon"></span> C++ 基础</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/helloworld/> <span class=md-ellipsis> Hello, World! </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/basic/> <span class=md-ellipsis> C++ 语法基础 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/var/> <span class=md-ellipsis> 变量 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/op/> <span class=md-ellipsis> 运算 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_4_2_5 type=checkbox> <label class=md-nav__link for=__nav_4_2_5 id=__nav_4_2_5_label tabindex=0><span class=md-ellipsis> 流程控制语句 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_4_2_5_label class=md-nav data-md-level=3><label class=md-nav__title for=__nav_4_2_5><span class="md-nav__icon md-icon"></span> 流程控制语句</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/branch/> <span class=md-ellipsis> 分支 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/loop/> <span class=md-ellipsis> 循环 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_4_2_6 type=checkbox> <label class=md-nav__link for=__nav_4_2_6 id=__nav_4_2_6_label tabindex=0><span class=md-ellipsis> 高级数据类型 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_4_2_6_label class=md-nav data-md-level=3><label class=md-nav__title for=__nav_4_2_6><span class="md-nav__icon md-icon"></span> 高级数据类型</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/array/> <span class=md-ellipsis> 数组 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/struct/> <span class=md-ellipsis> 结构体 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/union/> <span class=md-ellipsis> 联合体 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/pointer/> <span class=md-ellipsis> 指针 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../lang/func/> <span class=md-ellipsis> 函数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/file-op/> <span class=md-ellipsis> 文件操作 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_4_3 type=checkbox> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0><span class=md-ellipsis> C++ 标准库 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_4_3_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_4_3><span class="md-nav__icon md-icon"></span> C++ 标准库</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/> <span class=md-ellipsis> C++ 标准库简介 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_4_3_2 type=checkbox> <label class=md-nav__link for=__nav_4_3_2 id=__nav_4_3_2_label tabindex=0><span class=md-ellipsis> STL 容器 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_4_3_2_label class=md-nav data-md-level=3><label class=md-nav__title for=__nav_4_3_2><span class="md-nav__icon md-icon"></span> STL 容器</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/container/> <span class=md-ellipsis> STL 容器简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/iterator/> <span class=md-ellipsis> 迭代器 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/sequence-container/> <span class=md-ellipsis> 序列式容器 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/associative-container/> <span class=md-ellipsis> 关联式容器 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/unordered-container/> <span class=md-ellipsis> 无序关联式容器 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/container-adapter/> <span class=md-ellipsis> 容器适配器 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/algorithm/> <span class=md-ellipsis> STL 算法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/bitset/> <span class=md-ellipsis> bitset </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/string/> <span class=md-ellipsis> string </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/pair/> <span class=md-ellipsis> pair </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_4_4 type=checkbox> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0><span class=md-ellipsis> C++ 进阶 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_4_4_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_4_4><span class="md-nav__icon md-icon"></span> C++ 进阶</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/class/> <span class=md-ellipsis> 类 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/namespace/> <span class=md-ellipsis> 命名空间 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/value-category/> <span class=md-ellipsis> 值类别 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/op-overload/> <span class=md-ellipsis> 重载运算符 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/reference/> <span class=md-ellipsis> 引用 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/const/> <span class=md-ellipsis> 常量 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/new/> <span class=md-ellipsis> 新版 C++ 特性 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/lambda/> <span class=md-ellipsis> Lambda 表达式 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_4_4_9 type=checkbox> <label class=md-nav__link for=__nav_4_4_9 id=__nav_4_4_9_label tabindex=0><span class=md-ellipsis> pb_ds </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_4_4_9_label class=md-nav data-md-level=3><label class=md-nav__title for=__nav_4_4_9><span class="md-nav__icon md-icon"></span> pb_ds</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/pb-ds/> <span class=md-ellipsis> pb_ds 简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/pb-ds/pq/> <span class=md-ellipsis> 堆 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/pb-ds/tree/> <span class=md-ellipsis> 平衡树 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../lang/optimizations/> <span class=md-ellipsis> 编译优化 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../lang/cpp-other-langs/> <span class=md-ellipsis> C++ 与其他常用语言的区别 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/pas-cpp/> <span class=md-ellipsis> Pascal 转 C++ 急救 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/python/> <span class=md-ellipsis> Python 速成 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/java/> <span class=md-ellipsis> Java 速成 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/java-pro/> <span class=md-ellipsis> Java 进阶 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_5 type=checkbox> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0><span class=md-ellipsis> 算法基础 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_5_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_5><span class="md-nav__icon md-icon"></span> 算法基础</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../basic/> <span class=md-ellipsis> 算法基础简介 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_5_2 type=checkbox> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0><span class=md-ellipsis> 复杂度 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_5_2_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_5_2><span class="md-nav__icon md-icon"></span> 复杂度</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../basic/complexity/> <span class=md-ellipsis> 复杂度简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/amortized-analysis/> <span class=md-ellipsis> 均摊复杂度 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../basic/enumerate/> <span class=md-ellipsis> 枚举 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/simulate/> <span class=md-ellipsis> 模拟 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/divide-and-conquer/> <span class=md-ellipsis> 递归 & 分治 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/greedy/> <span class=md-ellipsis> 贪心 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_5_7 type=checkbox> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex=0><span class=md-ellipsis> 排序 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_5_7_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_5_7><span class="md-nav__icon md-icon"></span> 排序</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../basic/sort-intro/> <span class=md-ellipsis> 排序简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/selection-sort/> <span class=md-ellipsis> 选择排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/bubble-sort/> <span class=md-ellipsis> 冒泡排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/insertion-sort/> <span class=md-ellipsis> 插入排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/counting-sort/> <span class=md-ellipsis> 计数排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/radix-sort/> <span class=md-ellipsis> 基数排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/quick-sort/> <span class=md-ellipsis> 快速排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/merge-sort/> <span class=md-ellipsis> 归并排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/heap-sort/> <span class=md-ellipsis> 堆排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/bucket-sort/> <span class=md-ellipsis> 桶排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/shell-sort/> <span class=md-ellipsis> 希尔排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/tournament-sort/> <span class=md-ellipsis> 锦标赛排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/tim-sort/> <span class=md-ellipsis> Tim 排序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/stl-sort/> <span class=md-ellipsis> 排序相关 STL </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/use-of-sort/> <span class=md-ellipsis> 排序应用 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../basic/prefix-sum/> <span class=md-ellipsis> 前缀和 & 差分 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/binary/> <span class=md-ellipsis> 二分 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/binary-lifting/> <span class=md-ellipsis> 倍增 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/construction/> <span class=md-ellipsis> 构造 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_6 type=checkbox> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0><span class=md-ellipsis> 搜索 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_6_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_6><span class="md-nav__icon md-icon"></span> 搜索</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../search/> <span class=md-ellipsis> 搜索部分简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/dfs/> <span class=md-ellipsis> DFS（搜索） </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/bfs/> <span class=md-ellipsis> BFS（搜索） </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/bidirectional/> <span class=md-ellipsis> 双向搜索 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/heuristic/> <span class=md-ellipsis> 启发式搜索 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/astar/> <span class=md-ellipsis> A* </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/iterative/> <span class=md-ellipsis> 迭代加深搜索 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/idastar/> <span class=md-ellipsis> IDA* </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/backtracking/> <span class=md-ellipsis> 回溯法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/dlx/> <span class=md-ellipsis> Dancing Links </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/alpha-beta/> <span class=md-ellipsis> Alpha–Beta 剪枝 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/opt/> <span class=md-ellipsis> 优化 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_7 type=checkbox> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0><span class=md-ellipsis> 动态规划 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_7_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_7><span class="md-nav__icon md-icon"></span> 动态规划</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../dp/> <span class=md-ellipsis> 动态规划部分简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/basic/> <span class=md-ellipsis> 动态规划基础 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/memo/> <span class=md-ellipsis> 记忆化搜索 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/knapsack/> <span class=md-ellipsis> 背包 DP </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/interval/> <span class=md-ellipsis> 区间 DP </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/dag/> <span class=md-ellipsis> DAG 上的 DP </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/tree/> <span class=md-ellipsis> 树形 DP </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/state/> <span class=md-ellipsis> 状压 DP </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/number/> <span class=md-ellipsis> 数位 DP </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/plug/> <span class=md-ellipsis> 插头 DP </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/count/> <span class=md-ellipsis> 计数 DP </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/dynamic/> <span class=md-ellipsis> 动态 DP </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/probability/> <span class=md-ellipsis> 概率 DP </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/dp-of-dp/> <span class=md-ellipsis> DP 套 DP </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_7_15 type=checkbox> <label class=md-nav__link for=__nav_7_15 id=__nav_7_15_label tabindex=0><span class=md-ellipsis> DP 优化 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_7_15_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_7_15><span class="md-nav__icon md-icon"></span> DP 优化</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../dp/opt/dp-opt/> <span class=md-ellipsis> DP 优化简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/opt/monotonous-queue-stack/> <span class=md-ellipsis> 单调队列/单调栈优化 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/opt/slope/> <span class=md-ellipsis> 斜率优化 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/opt/quadrangle/> <span class=md-ellipsis> 四边形不等式优化 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/opt/slope-trick/> <span class=md-ellipsis> Slope Trick 优化 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/opt/wqs-binary-search/> <span class=md-ellipsis> WQS 二分 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/opt/state/> <span class=md-ellipsis> 状态设计优化 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../dp/misc/> <span class=md-ellipsis> 其它 DP 方法 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_8 type=checkbox> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0><span class=md-ellipsis> 字符串 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_8_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_8><span class="md-nav__icon md-icon"></span> 字符串</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../string/> <span class=md-ellipsis> 字符串部分简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/basic/> <span class=md-ellipsis> 字符串基础 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/lib-func/> <span class=md-ellipsis> 标准库 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/match/> <span class=md-ellipsis> 字符串匹配 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/hash/> <span class=md-ellipsis> 字符串哈希 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/trie/> <span class=md-ellipsis> 字典树 (Trie) </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/kmp/> <span class=md-ellipsis> 前缀函数与 KMP 算法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/bm/> <span class=md-ellipsis> Boyer–Moore 算法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/z-func/> <span class=md-ellipsis> Z 函数（扩展 KMP） </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/ac-automaton/> <span class=md-ellipsis> AC 自动机 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_8_11 type=checkbox> <label class=md-nav__link for=__nav_8_11 id=__nav_8_11_label tabindex=0><span class=md-ellipsis> 后缀数组 (SA) </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_8_11_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_8_11><span class="md-nav__icon md-icon"></span> 后缀数组 (SA)</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../string/sa/> <span class=md-ellipsis> 后缀数组简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/sa-optimal-inplace/> <span class=md-ellipsis> 最优原地后缀排序算法 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../string/sam/> <span class=md-ellipsis> 后缀自动机 (SAM) </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/suffix-bst/> <span class=md-ellipsis> 后缀平衡树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/general-sam/> <span class=md-ellipsis> 广义后缀自动机 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/suffix-tree/> <span class=md-ellipsis> 后缀树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/manacher/> <span class=md-ellipsis> Manacher </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/pam/> <span class=md-ellipsis> 回文树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/seq-automaton/> <span class=md-ellipsis> 序列自动机 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/minimal-string/> <span class=md-ellipsis> 最小表示法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/lyndon/> <span class=md-ellipsis> Lyndon 分解 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/main-lorentz/> <span class=md-ellipsis> Main–Lorentz 算法 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_9 type=checkbox> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0><span class=md-ellipsis> 数学 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_9_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_9><span class="md-nav__icon md-icon"></span> 数学</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/> <span class=md-ellipsis> 数学部分简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/boolean-algebra/> <span class=md-ellipsis> 布尔代数 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_9_3 type=checkbox> <label class=md-nav__link for=__nav_9_3 id=__nav_9_3_label tabindex=0><span class=md-ellipsis> 数字系统 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_9_3_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_9_3><span class="md-nav__icon md-icon"></span> 数字系统</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/numeral-sys/intro/> <span class=md-ellipsis> 数字系统简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/numeral-sys/base/> <span class=md-ellipsis> 进位制 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/numeral-sys/balanced-ternary/> <span class=md-ellipsis> 平衡三进制 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/numeral-sys/gray-code/> <span class=md-ellipsis> 格雷码 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../math/bit/> <span class=md-ellipsis> 位操作 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/binary-set/> <span class=md-ellipsis> 二进制集合操作 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/bignum/> <span class=md-ellipsis> 高精度计算 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/binary-exponentiation/> <span class=md-ellipsis> 快速幂 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/permutation/> <span class=md-ellipsis> 置换和排列 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/coordinate/> <span class=md-ellipsis> 弧度制与坐标系 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/complex/> <span class=md-ellipsis> 复数 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_9_11 type=checkbox> <label class=md-nav__link for=__nav_9_11 id=__nav_9_11_label tabindex=0><span class=md-ellipsis> 数论 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_9_11_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_9_11><span class="md-nav__icon md-icon"></span> 数论</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/basic/> <span class=md-ellipsis> 数论基础 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/mod-arithmetic/> <span class=md-ellipsis> 模算术简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/prime/> <span class=md-ellipsis> 素数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/gcd/> <span class=md-ellipsis> 最大公约数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/euler-totient/> <span class=md-ellipsis> 欧拉函数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/sieve/> <span class=md-ellipsis> 筛法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/pollard-rho/> <span class=md-ellipsis> 分解质因数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/bezouts/> <span class=md-ellipsis> 裴蜀定理 & 一次不定方程 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/fermat/> <span class=md-ellipsis> 费马小定理 & 欧拉定理 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/inverse/> <span class=md-ellipsis> 模逆元 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/linear-equation/> <span class=md-ellipsis> 线性同余方程 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/crt/> <span class=md-ellipsis> 中国剩余定理 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/lift-the-exponent/> <span class=md-ellipsis> 升幂引理 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/factorial/> <span class=md-ellipsis> 阶乘取模 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/lucas/> <span class=md-ellipsis> 卢卡斯定理 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/congruence-equation/> <span class=md-ellipsis> 同余方程 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/quad-residue/> <span class=md-ellipsis> 二次剩余 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/primitive-root/> <span class=md-ellipsis> 阶 & 原根 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/discrete-logarithm/> <span class=md-ellipsis> 离散对数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/residue/> <span class=md-ellipsis> 高次剩余 & 单位根 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/sqrt-decomposition/> <span class=md-ellipsis> 数论分块 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/dirichlet/> <span class=md-ellipsis> 狄利克雷卷积 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/mobius/> <span class=md-ellipsis> 莫比乌斯反演 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/du/> <span class=md-ellipsis> 杜教筛 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/powerful-number/> <span class=md-ellipsis> Powerful Number 筛 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/min-25/> <span class=md-ellipsis> Min_25 筛 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/zhou/> <span class=md-ellipsis> 洲阁筛 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/euclidean/> <span class=md-ellipsis> 类欧几里德算法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/meissel-lehmer/> <span class=md-ellipsis> Meissel–Lehmer 算法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/continued-fraction/> <span class=md-ellipsis> 连分数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/stern-brocot/> <span class=md-ellipsis> Stern–Brocot 树与 Farey 序列 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/quadratic/> <span class=md-ellipsis> 二次域 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/pell-equation/> <span class=md-ellipsis> Pell 方程 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_9_12 type=checkbox> <label class=md-nav__link for=__nav_9_12 id=__nav_9_12_label tabindex=0><span class=md-ellipsis> 多项式与生成函数 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_9_12_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_9_12><span class="md-nav__icon md-icon"></span> 多项式与生成函数</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/poly/intro/> <span class=md-ellipsis> 多项式与生成函数简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/fundamental/> <span class=md-ellipsis> 代数基本定理 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/fft/> <span class=md-ellipsis> 快速傅里叶变换 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/ntt/> <span class=md-ellipsis> 快速数论变换 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/fwt/> <span class=md-ellipsis> 快速沃尔什变换 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/czt/> <span class=md-ellipsis> Chirp Z 变换 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/newton/> <span class=md-ellipsis> 多项式牛顿迭代 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/multipoint-eval-interpolation/> <span class=md-ellipsis> 多项式多点求值|快速插值 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/elementary-func/> <span class=md-ellipsis> 多项式初等函数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/linear-recurrence/> <span class=md-ellipsis> 常系数齐次线性递推 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/shift/> <span class=md-ellipsis> 多项式平移|连续点值平移 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/symbolic-method/> <span class=md-ellipsis> 符号化方法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/lagrange-inversion/> <span class=md-ellipsis> Lagrange 反演 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/comp-rev/> <span class=md-ellipsis> 形式幂级数复合|复合逆 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/ogf/> <span class=md-ellipsis> 普通生成函数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/egf/> <span class=md-ellipsis> 指数生成函数 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_9_13 type=checkbox> <label class=md-nav__link for=__nav_9_13 id=__nav_9_13_label tabindex=0><span class=md-ellipsis> 组合数学 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_9_13_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_9_13><span class="md-nav__icon md-icon"></span> 组合数学</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/combination/> <span class=md-ellipsis> 排列组合 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/drawer-principle/> <span class=md-ellipsis> 抽屉原理 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/inclusion-exclusion-principle/> <span class=md-ellipsis> 容斥原理 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/fibonacci/> <span class=md-ellipsis> 斐波那契数列 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/derangement/> <span class=md-ellipsis> 错位排列 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/catalan/> <span class=md-ellipsis> 卡特兰数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/stirling/> <span class=md-ellipsis> 斯特林数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/bell/> <span class=md-ellipsis> 贝尔数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/bernoulli/> <span class=md-ellipsis> 伯努利数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/entringer/> <span class=md-ellipsis> Entringer Number </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/eulerian/> <span class=md-ellipsis> Eulerian Number </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/partition/> <span class=md-ellipsis> 分拆数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/vandermonde-convolution/> <span class=md-ellipsis> 范德蒙德卷积 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/polya/> <span class=md-ellipsis> Pólya 计数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/graph-enumeration/> <span class=md-ellipsis> 图论计数 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_9_14 type=checkbox> <label class=md-nav__link for=__nav_9_14 id=__nav_9_14_label tabindex=0><span class=md-ellipsis> 线性代数 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_9_14_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_9_14><span class="md-nav__icon md-icon"></span> 线性代数</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/> <span class=md-ellipsis> 线性代数简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/vector/> <span class=md-ellipsis> 向量 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/product/> <span class=md-ellipsis> 内积和外积 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/matrix/> <span class=md-ellipsis> 矩阵 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/elementary-operations/> <span class=md-ellipsis> 初等变换 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/determinant/> <span class=md-ellipsis> 行列式 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/vector-space/> <span class=md-ellipsis> 线性空间 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/basis/> <span class=md-ellipsis> 线性基 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/linear-mapping/> <span class=md-ellipsis> 线性映射 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/char-poly/> <span class=md-ellipsis> 特征多项式 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/diagonalization/> <span class=md-ellipsis> 对角化 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-algebra/jordan/> <span class=md-ellipsis> Jordan标准型 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_9_15 type=checkbox> <label class=md-nav__link for=__nav_9_15 id=__nav_9_15_label tabindex=0><span class=md-ellipsis> 线性规划 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_9_15_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_9_15><span class="md-nav__icon md-icon"></span> 线性规划</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/linear-programming/> <span class=md-ellipsis> 线性规划基础 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/simplex/> <span class=md-ellipsis> 单纯形法 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_9_16 type=checkbox> <label class=md-nav__link for=__nav_9_16 id=__nav_9_16_label tabindex=0><span class=md-ellipsis> 抽象代数 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_9_16_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_9_16><span class="md-nav__icon md-icon"></span> 抽象代数</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/algebra/basic/> <span class=md-ellipsis> 基本概念 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/algebra/group-theory/> <span class=md-ellipsis> 群论 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/algebra/ring-theory/> <span class=md-ellipsis> 环论 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/algebra/field-theory/> <span class=md-ellipsis> 域论 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/algebra/schreier-sims/> <span class=md-ellipsis> Schreier–Sims 算法 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_9_17 type=checkbox> <label class=md-nav__link for=__nav_9_17 id=__nav_9_17_label tabindex=0><span class=md-ellipsis> 概率论 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_9_17_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_9_17><span class="md-nav__icon md-icon"></span> 概率论</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/probability/basic-conception/> <span class=md-ellipsis> 基本概念 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/probability/conditional-probability/> <span class=md-ellipsis> 条件概率与独立性 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/probability/random-variable/> <span class=md-ellipsis> 随机变量 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/probability/exp-var/> <span class=md-ellipsis> 随机变量的数字特征 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/probability/concentration-inequality/> <span class=md-ellipsis> 概率不等式 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_9_18 type=checkbox> <label class=md-nav__link for=__nav_9_18 id=__nav_9_18_label tabindex=0><span class=md-ellipsis> 博弈论 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_9_18_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_9_18><span class="md-nav__icon md-icon"></span> 博弈论</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/game-theory/intro/> <span class=md-ellipsis> 博弈论简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/game-theory/impartial-game/> <span class=md-ellipsis> 公平组合游戏 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/game-theory/zero-sum-game/> <span class=md-ellipsis> 零和游戏 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/game-theory/partizan-game/> <span class=md-ellipsis> 非公平组合游戏 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_9_19 type=checkbox> <label class=md-nav__link for=__nav_9_19 id=__nav_9_19_label tabindex=0><span class=md-ellipsis> 数值算法 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_9_19_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_9_19><span class="md-nav__icon md-icon"></span> 数值算法</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/numerical/interp/> <span class=md-ellipsis> 插值 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/numerical/integral/> <span class=md-ellipsis> 数值积分 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/numerical/gauss/> <span class=md-ellipsis> 高斯消元 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/numerical/newton/> <span class=md-ellipsis> 牛顿迭代法 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../math/order-theory/> <span class=md-ellipsis> 序理论 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/young-tableau/> <span class=md-ellipsis> 杨氏矩阵 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/matroid/> <span class=md-ellipsis> 拟阵 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/berlekamp-massey/> <span class=md-ellipsis> Berlekamp–Massey 算法 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_10 type=checkbox> <label class=md-nav__link for=__nav_10 id=__nav_10_label><span class=md-ellipsis> 数据结构 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_10_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_10><span class="md-nav__icon md-icon"></span> 数据结构</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../> <span class=md-ellipsis> 数据结构部分简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../stack/> <span class=md-ellipsis> 栈 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../queue/> <span class=md-ellipsis> 队列 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../linked-list/> <span class=md-ellipsis> 链表 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../hash/> <span class=md-ellipsis> 哈希表 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_10_6 type=checkbox> <label class=md-nav__link for=__nav_10_6 id=__nav_10_6_label tabindex=0><span class=md-ellipsis> 并查集 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_10_6_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_10_6><span class="md-nav__icon md-icon"></span> 并查集</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../dsu/> <span class=md-ellipsis> 并查集 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../dsu-complexity/> <span class=md-ellipsis> 并查集复杂度 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_10_7 type=checkbox> <label class=md-nav__link for=__nav_10_7 id=__nav_10_7_label tabindex=0><span class=md-ellipsis> 堆 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_10_7_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_10_7><span class="md-nav__icon md-icon"></span> 堆</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../heap/> <span class=md-ellipsis> 堆简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../binary-heap/> <span class=md-ellipsis> 二叉堆 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../pairing-heap/> <span class=md-ellipsis> 配对堆 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../leftist-tree/> <span class=md-ellipsis> 左偏树 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_10_8 type=checkbox> <label class=md-nav__link for=__nav_10_8 id=__nav_10_8_label tabindex=0><span class=md-ellipsis> 块状数据结构 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_10_8_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_10_8><span class="md-nav__icon md-icon"></span> 块状数据结构</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../decompose/> <span class=md-ellipsis> 分块思想 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../block-array/> <span class=md-ellipsis> 块状数组 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../block-list/> <span class=md-ellipsis> 块状链表 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../tree-decompose/> <span class=md-ellipsis> 树分块 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../sqrt-tree/> <span class=md-ellipsis> Sqrt Tree </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../monotonous-stack/> <span class=md-ellipsis> 单调栈 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../monotonous-queue/> <span class=md-ellipsis> 单调队列 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../sparse-table/> <span class=md-ellipsis> ST 表 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../fenwick/> <span class=md-ellipsis> 树状数组 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_10_13 type=checkbox> <label class=md-nav__link for=__nav_10_13 id=__nav_10_13_label tabindex=0><span class=md-ellipsis> 线段树 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_10_13_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_10_13><span class="md-nav__icon md-icon"></span> 线段树</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../seg/> <span class=md-ellipsis> 线段树基础 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../seg-merge-split/> <span class=md-ellipsis> 线段树合并 & 分裂 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../li-chao-tree/> <span class=md-ellipsis> 李超线段树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../cat-tree/> <span class=md-ellipsis> 猫树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../seg-beats/> <span class=md-ellipsis> 区间最值操作 & 区间历史最值 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../kinetic-tournament-tree/> <span class=md-ellipsis> Kinetic Tournament Tree </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../dividing/> <span class=md-ellipsis> 划分树 </span> </a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_10_15 type=checkbox> <label class=md-nav__link for=__nav_10_15 id=__nav_10_15_label tabindex=0><span class=md-ellipsis> 二叉搜索树 & 平衡树 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_10_15_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_10_15><span class="md-nav__icon md-icon"></span> 二叉搜索树 & 平衡树</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../bst/> <span class=md-ellipsis> 二叉搜索树 & 平衡树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../treap/> <span class=md-ellipsis> Treap </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../splay/> <span class=md-ellipsis> Splay 树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../wblt/> <span class=md-ellipsis> WBLT </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../sgt/> <span class=md-ellipsis> 替罪羊树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../cartesian-tree/> <span class=md-ellipsis> 笛卡尔树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../sbt/> <span class=md-ellipsis> Size Balanced Tree </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../avl/> <span class=md-ellipsis> AVL 树 </span> </a></li><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> 红黑树 </span> <span class="md-nav__icon md-icon"></span></label> <a class="md-nav__link md-nav__link--active" href=./> <span class=md-ellipsis> 红黑树 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> 目录</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#性质> <span class=md-ellipsis> 性质 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#红黑树类的定义> <span class=md-ellipsis> 红黑树类的定义 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#操作> <span class=md-ellipsis> 操作 </span> </a> <nav aria-label=操作 class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#旋转> <span class=md-ellipsis> 旋转 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#插入> <span class=md-ellipsis> 插入 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#插入后的平衡维护> <span class=md-ellipsis> 插入后的平衡维护 </span> </a> <nav aria-label=插入后的平衡维护 class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#insert-case-1> <span class=md-ellipsis> Insert case 1 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#insert-case-2> <span class=md-ellipsis> Insert case 2 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#insert-case-3> <span class=md-ellipsis> Insert case 3 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=#删除> <span class=md-ellipsis> 删除 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#删除后的平衡维护> <span class=md-ellipsis> 删除后的平衡维护 </span> </a> <nav aria-label=删除后的平衡维护 class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#delete-case-1> <span class=md-ellipsis> Delete case 1 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#delete-case-2> <span class=md-ellipsis> Delete case 2 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#delete-case-3> <span class=md-ellipsis> Delete case 3 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#delete-case-4> <span class=md-ellipsis> Delete case 4 </span> </a></li></ul></nav></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=#参考代码> <span class=md-ellipsis> 参考代码 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#与-2-3-4-树的关系> <span class=md-ellipsis> 与 2-3-4 树的关系 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#实际工程项目中的使用> <span class=md-ellipsis> 实际工程项目中的使用 </span> </a> <nav aria-label=实际工程项目中的使用 class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#linux> <span class=md-ellipsis> Linux </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#nginx> <span class=md-ellipsis> Nginx </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#c> <span class=md-ellipsis> C++ </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#openjdk> <span class=md-ellipsis> OpenJDK </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=#参考资料> <span class=md-ellipsis> 参考资料 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../llrbt/> <span class=md-ellipsis> 左偏红黑树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../aa-tree/> <span class=md-ellipsis> AA 树 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../skiplist/> <span class=md-ellipsis> 跳表 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_10_17 type=checkbox> <label class=md-nav__link for=__nav_10_17 id=__nav_10_17_label tabindex=0><span class=md-ellipsis> 可持久化数据结构 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_10_17_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_10_17><span class="md-nav__icon md-icon"></span> 可持久化数据结构</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../persistent/> <span class=md-ellipsis> 可持久化数据结构简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../persistent-seg/> <span class=md-ellipsis> 可持久化线段树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../persistent-block-array/> <span class=md-ellipsis> 可持久化块状数组 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../persistent-balanced/> <span class=md-ellipsis> 可持久化平衡树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../persistent-trie/> <span class=md-ellipsis> 可持久化字典树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../persistent-heap/> <span class=md-ellipsis> 可持久化可并堆 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_10_18 type=checkbox> <label class=md-nav__link for=__nav_10_18 id=__nav_10_18_label tabindex=0><span class=md-ellipsis> 树套树 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_10_18_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_10_18><span class="md-nav__icon md-icon"></span> 树套树</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../seg-in-seg/> <span class=md-ellipsis> 线段树套线段树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../seg-in-balanced/> <span class=md-ellipsis> 平衡树套线段树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../balanced-in-seg/> <span class=md-ellipsis> 线段树套平衡树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../seg-in-bit/> <span class=md-ellipsis> 树状数组套权值线段树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../bit-in-block-array/> <span class=md-ellipsis> 分块套树状数组 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../kdt/> <span class=md-ellipsis> K-D Tree </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_10_20 type=checkbox> <label class=md-nav__link for=__nav_10_20 id=__nav_10_20_label tabindex=0><span class=md-ellipsis> 动态树 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_10_20_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_10_20><span class="md-nav__icon md-icon"></span> 动态树</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../lct/> <span class=md-ellipsis> Link Cut Tree </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../global-bst/> <span class=md-ellipsis> 全局平衡二叉树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../ett/> <span class=md-ellipsis> Euler Tour Tree </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../top-tree/> <span class=md-ellipsis> Top Tree </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../divide-combine/> <span class=md-ellipsis> 析合树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../pq-tree/> <span class=md-ellipsis> PQ 树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../finger-tree/> <span class=md-ellipsis> 手指树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../huffman-tree/> <span class=md-ellipsis> 霍夫曼树 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_11 type=checkbox> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0><span class=md-ellipsis> 图论 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_11_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_11><span class="md-nav__icon md-icon"></span> 图论</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/> <span class=md-ellipsis> 图论部分简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/concept/> <span class=md-ellipsis> 图论相关概念 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/save/> <span class=md-ellipsis> 图的存储 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/dfs/> <span class=md-ellipsis> DFS（图论） </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/bfs/> <span class=md-ellipsis> BFS（图论） </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_11_6 type=checkbox> <label class=md-nav__link for=__nav_11_6 id=__nav_11_6_label tabindex=0><span class=md-ellipsis> 树上问题 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_11_6_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_11_6><span class="md-nav__icon md-icon"></span> 树上问题</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-basic/> <span class=md-ellipsis> 树基础 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-diameter/> <span class=md-ellipsis> 树的直径 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-center/> <span class=md-ellipsis> 树的中心 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-centroid/> <span class=md-ellipsis> 树的重心 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/lca/> <span class=md-ellipsis> 最近公共祖先 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/hld/> <span class=md-ellipsis> 树链剖分 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/dsu-on-tree/> <span class=md-ellipsis> 树上启发式合并 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/virtual-tree/> <span class=md-ellipsis> 虚树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-divide/> <span class=md-ellipsis> 树分治 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/dynamic-tree-divide/> <span class=md-ellipsis> 动态树分治 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-ahu/> <span class=md-ellipsis> AHU 算法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-hash/> <span class=md-ellipsis> 树哈希 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-random-walk/> <span class=md-ellipsis> 树上随机游走 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../graph/dag/> <span class=md-ellipsis> 有向无环图 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/topo/> <span class=md-ellipsis> 拓扑排序 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_11_9 type=checkbox> <label class=md-nav__link for=__nav_11_9 id=__nav_11_9_label tabindex=0><span class=md-ellipsis> 最短路问题 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_11_9_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_11_9><span class="md-nav__icon md-icon"></span> 最短路问题</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/shortest-path/> <span class=md-ellipsis> 最短路 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/diff-constraints/> <span class=md-ellipsis> 差分约束 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/kth-path/> <span class=md-ellipsis> k 短路 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/mod-shortest-path/> <span class=md-ellipsis> 同余最短路 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_11_10 type=checkbox> <label class=md-nav__link for=__nav_11_10 id=__nav_11_10_label tabindex=0><span class=md-ellipsis> 生成树问题 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_11_10_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_11_10><span class="md-nav__icon md-icon"></span> 生成树问题</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/mst/> <span class=md-ellipsis> 最小生成树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/dmst/> <span class=md-ellipsis> 最小树形图 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/mdst/> <span class=md-ellipsis> 最小直径生成树 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../graph/steiner-tree/> <span class=md-ellipsis> 斯坦纳树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/node/> <span class=md-ellipsis> 拆点 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_11_13 type=checkbox> <label class=md-nav__link for=__nav_11_13 id=__nav_11_13_label tabindex=0><span class=md-ellipsis> 连通性相关 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_11_13_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_11_13><span class="md-nav__icon md-icon"></span> 连通性相关</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/scc/> <span class=md-ellipsis> 强连通分量 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/bcc/> <span class=md-ellipsis> 双连通分量 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/cut/> <span class=md-ellipsis> 割点和桥 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/block-forest/> <span class=md-ellipsis> 圆方树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/connectivity/> <span class=md-ellipsis> 点/边连通度 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../graph/rings-count/> <span class=md-ellipsis> 环计数问题 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/min-cycle/> <span class=md-ellipsis> 最小环 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/2-sat/> <span class=md-ellipsis> 2-SAT </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/euler/> <span class=md-ellipsis> 欧拉图 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/hamilton/> <span class=md-ellipsis> 哈密顿图 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/bi-graph/> <span class=md-ellipsis> 二分图 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/planar/> <span class=md-ellipsis> 平面图 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/chord/> <span class=md-ellipsis> 弦图 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/color/> <span class=md-ellipsis> 图的着色 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_11_23 type=checkbox> <label class=md-nav__link for=__nav_11_23 id=__nav_11_23_label tabindex=0><span class=md-ellipsis> 网络流 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_11_23_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_11_23><span class="md-nav__icon md-icon"></span> 网络流</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/flow/> <span class=md-ellipsis> 网络流简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/flow/max-flow/> <span class=md-ellipsis> 最大流 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/flow/min-cut/> <span class=md-ellipsis> 最小割 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/flow/min-cost/> <span class=md-ellipsis> 费用流 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/flow/bound/> <span class=md-ellipsis> 上下界网络流 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/stoer-wagner/> <span class=md-ellipsis> Stoer–Wagner 算法 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_11_24 type=checkbox> <label class=md-nav__link for=__nav_11_24 id=__nav_11_24_label tabindex=0><span class=md-ellipsis> 图的匹配 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_11_24_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_11_24><span class="md-nav__icon md-icon"></span> 图的匹配</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/graph-match/> <span class=md-ellipsis> 图匹配 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/bigraph-match/> <span class=md-ellipsis> 二分图最大匹配 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/bigraph-weight-match/> <span class=md-ellipsis> 二分图最大权匹配 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/general-match/> <span class=md-ellipsis> 一般图最大匹配 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/general-weight-match/> <span class=md-ellipsis> 一般图最大权匹配 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/stable-match/> <span class=md-ellipsis> 稳定匹配 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../graph/prufer/> <span class=md-ellipsis> Prüfer 序列 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/matrix-tree/> <span class=md-ellipsis> 矩阵树定理 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/lgv/> <span class=md-ellipsis> LGV 引理 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/max-clique/> <span class=md-ellipsis> 最大团搜索算法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/dominator-tree/> <span class=md-ellipsis> 支配树 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-random-walk/> <span class=md-ellipsis> 图上随机游走 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_12 type=checkbox> <label class=md-nav__link for=__nav_12 id=__nav_12_label tabindex=0><span class=md-ellipsis> 计算几何 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_12_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_12><span class="md-nav__icon md-icon"></span> 计算几何</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../geometry/> <span class=md-ellipsis> 计算几何部分简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/2d/> <span class=md-ellipsis> 二维计算几何基础 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/3d/> <span class=md-ellipsis> 三维计算几何基础 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/distance/> <span class=md-ellipsis> 距离 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/pick/> <span class=md-ellipsis> Pick 定理 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/triangulation/> <span class=md-ellipsis> 三角剖分 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/convex-hull/> <span class=md-ellipsis> 凸包 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/scanning/> <span class=md-ellipsis> 扫描线 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/rotating-calipers/> <span class=md-ellipsis> 旋转卡壳 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/half-plane/> <span class=md-ellipsis> 半平面交 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/nearest-points/> <span class=md-ellipsis> 平面最近点对 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/random-incremental/> <span class=md-ellipsis> 随机增量法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/inverse/> <span class=md-ellipsis> 反演变换 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/misc/> <span class=md-ellipsis> 计算几何杂项 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_13 type=checkbox> <label class=md-nav__link for=__nav_13 id=__nav_13_label tabindex=0><span class=md-ellipsis> 杂项 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_13_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_13><span class="md-nav__icon md-icon"></span> 杂项</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../misc/> <span class=md-ellipsis> 杂项简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/discrete/> <span class=md-ellipsis> 离散化 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/two-pointer/> <span class=md-ellipsis> 双指针 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_13_4 type=checkbox> <label class=md-nav__link for=__nav_13_4 id=__nav_13_4_label tabindex=0><span class=md-ellipsis> 离线算法 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_13_4_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_13_4><span class="md-nav__icon md-icon"></span> 离线算法</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../misc/offline/> <span class=md-ellipsis> 离线算法简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/cdq-divide/> <span class=md-ellipsis> CDQ 分治 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/parallel-binsearch/> <span class=md-ellipsis> 整体二分 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_13_4_4 type=checkbox> <label class=md-nav__link for=__nav_13_4_4 id=__nav_13_4_4_label tabindex=0><span class=md-ellipsis> 莫队算法 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_13_4_4_label class=md-nav data-md-level=3><label class=md-nav__title for=__nav_13_4_4><span class="md-nav__icon md-icon"></span> 莫队算法</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../misc/mo-algo-intro/> <span class=md-ellipsis> 莫队算法简介 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/mo-algo/> <span class=md-ellipsis> 普通莫队算法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/modifiable-mo-algo/> <span class=md-ellipsis> 带修改莫队 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/mo-algo-on-tree/> <span class=md-ellipsis> 树上莫队 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/rollback-mo-algo/> <span class=md-ellipsis> 回滚莫队 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/mo-algo-2dimen/> <span class=md-ellipsis> 二维莫队 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/mo-algo-secondary-offline/> <span class=md-ellipsis> 莫队二次离线 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/mo-algo-with-bitset/> <span class=md-ellipsis> 莫队配合 bitset </span> </a></li></ul></nav></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../misc/frac-programming/> <span class=md-ellipsis> 分数规划 </span> </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_13_6 type=checkbox> <label class=md-nav__link for=__nav_13_6 id=__nav_13_6_label tabindex=0><span class=md-ellipsis> 随机化 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_13_6_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_13_6><span class="md-nav__icon md-icon"></span> 随机化</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../misc/random/> <span class=md-ellipsis> 随机函数 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/rand-technique/> <span class=md-ellipsis> 随机化技巧 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/hill-climbing/> <span class=md-ellipsis> 爬山算法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/simulated-annealing/> <span class=md-ellipsis> 模拟退火 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../misc/hoverline/> <span class=md-ellipsis> 悬线法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/fsm/> <span class=md-ellipsis> 有限状态自动机 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/cc-basic/> <span class=md-ellipsis> 计算理论基础 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/endianness/> <span class=md-ellipsis> 字节顺序 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/josephus/> <span class=md-ellipsis> 约瑟夫问题 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/expression/> <span class=md-ellipsis> 表达式求值 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/job-order/> <span class=md-ellipsis> 在一台机器上规划任务 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/main-element/> <span class=md-ellipsis> 主元素问题 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/garsia-wachs/> <span class=md-ellipsis> Garsia–Wachs 算法 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/15-puzzle/> <span class=md-ellipsis> 15-puzzle </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/kahan-summation/> <span class=md-ellipsis> Kahan 求和 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/odt/> <span class=md-ellipsis> 珂朵莉树/颜色段均摊 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../misc/space-optimization/> <span class=md-ellipsis> 空间优化简介 </span> </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-nav__toggle md-toggle" id=__nav_14 type=checkbox> <label class=md-nav__link for=__nav_14 id=__nav_14_label tabindex=0><span class=md-ellipsis> 专题 </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=false aria-labelledby=__nav_14_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_14><span class="md-nav__icon md-icon"></span> 专题</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../topic/rmq/> <span class=md-ellipsis> RMQ </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../topic/dsu-app/> <span class=md-ellipsis> 并查集应用 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../topic/bracket/> <span class=md-ellipsis> 括号序列 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=../../topic/segment-tree-offline/> <span class=md-ellipsis> 线段树与离线询问 </span> </a></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--secondary" aria-label=目录><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> 目录</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#性质> <span class=md-ellipsis> 性质 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#红黑树类的定义> <span class=md-ellipsis> 红黑树类的定义 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#操作> <span class=md-ellipsis> 操作 </span> </a> <nav aria-label=操作 class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#旋转> <span class=md-ellipsis> 旋转 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#插入> <span class=md-ellipsis> 插入 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#插入后的平衡维护> <span class=md-ellipsis> 插入后的平衡维护 </span> </a> <nav aria-label=插入后的平衡维护 class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#insert-case-1> <span class=md-ellipsis> Insert case 1 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#insert-case-2> <span class=md-ellipsis> Insert case 2 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#insert-case-3> <span class=md-ellipsis> Insert case 3 </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=#删除> <span class=md-ellipsis> 删除 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#删除后的平衡维护> <span class=md-ellipsis> 删除后的平衡维护 </span> </a> <nav aria-label=删除后的平衡维护 class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#delete-case-1> <span class=md-ellipsis> Delete case 1 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#delete-case-2> <span class=md-ellipsis> Delete case 2 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#delete-case-3> <span class=md-ellipsis> Delete case 3 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#delete-case-4> <span class=md-ellipsis> Delete case 4 </span> </a></li></ul></nav></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=#参考代码> <span class=md-ellipsis> 参考代码 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#与-2-3-4-树的关系> <span class=md-ellipsis> 与 2-3-4 树的关系 </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#实际工程项目中的使用> <span class=md-ellipsis> 实际工程项目中的使用 </span> </a> <nav aria-label=实际工程项目中的使用 class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#linux> <span class=md-ellipsis> Linux </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#nginx> <span class=md-ellipsis> Nginx </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#c> <span class=md-ellipsis> C++ </span> </a></li><li class=md-nav__item><a class=md-nav__link href=#openjdk> <span class=md-ellipsis> OpenJDK </span> </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=#参考资料> <span class=md-ellipsis> 参考资料 </span> </a></li></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><a class="md-content__button md-icon" href="https://oi-wiki.org/edit-landing/?ref=/ds/rbtree.md" rel=edit title=编辑此页> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg> </a><h1>红黑树</h1><p data-original-document-end=73 data-original-document-start=0>红黑树是一种自平衡的二叉搜索树．每个节点额外存储了一个 color 字段 ("RED" or "BLACK")，用于确保树在插入和删除时保持平衡．</p><p data-original-document-end=173 data-original-document-start=75>红黑树是 4 阶 B 树（<a href=https://en.wikipedia.org/wiki/2%E2%80%933%E2%80%934_tree target=_blank>2-3-4 树</a>）的变体．<sup id=fnref:gilbas1978><a class=footnote-ref href=#fn:gilbas1978>1</a></sup></p><h2 data-original-document-end=180 data-original-document-start=175 id=性质>性质<a title="Permanent link" class=headerlink href=#性质></a></h2><p data-original-document-end=201 data-original-document-start=182>一棵合法的红黑树必须遵循以下四条性质：</p><ol data-original-document-end=284 data-original-document-start=203><li>节点为红色或黑色</li><li>NIL 节点（空叶子节点）为黑色</li><li>红色节点的子节点为黑色</li><li>从根节点到 NIL 节点的每条路径上的黑色节点数量相同</li></ol><p data-original-document-end=298 data-original-document-start=286>下图为一棵合法的红黑树：</p><p data-original-document-end=344 data-original-document-start=300><img alt=rbtree-example src=../images/rbtree-example.svg></p><details class=note data-original-document-end=971 data-original-document-start=346 open><summary>Note</summary> <p>部分资料中还加入了第五条性质，即根节点必须为黑色，这条性质要求完成插入操作后若根节点为红色则将其染黑，但由于将根节点染黑的操作也可以延迟至删除操作时进行，因此，该条性质并非必须满足（本文给出的代码实现中满足该性质）．为严谨起见，这里同时引用 <a href=https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#Properties target=_blank>维基百科原文</a> 进行说明：</p> <blockquote><p>Some authors, e.g. Cormen & al.,<sup id=fnref:cite_note-cormen2009-18><a class=footnote-ref href=#fn:cite_note-cormen2009-18>3</a></sup>claim "the root is black" as fifth requirement; but not Mehlhorn & Sanders<sup id=fnref:cite_note-mehlhorn2008-17><a class=footnote-ref href=#fn:cite_note-mehlhorn2008-17>4</a></sup>or Sedgewick & Wayne.<sup id=fnref:cite_note-algs4-16><a class=footnote-ref href=#fn:cite_note-algs4-16>5</a></sup>Since the root can always be changed from red to black, this rule has little effect on analysis. This article also omits it, because it slightly disturbs the recursive algorithms and proofs.</p></blockquote></details><h2 data-original-document-end=983 data-original-document-start=973 id=红黑树类的定义>红黑树类的定义<a title="Permanent link" class=headerlink href=#红黑树类的定义></a></h2><p data-original-document-end=1108 data-original-document-start=985></p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span></pre></div></td><td class=code><div><pre><span></span><code><span class=cm>/**</span>
<span class=cm> * An RBTree-based set implementation</span>
<span class=cm> *</span>
<span class=cm> * @tparam key_t key type</span>
<span class=cm> * @tparam compare_t compare function</span>
<span class=cm> */</span>
<span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>key_t</span><span class=p>,</span><span class=w> </span><span class=k>typename</span><span class=w> </span><span class=nc>compare_t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>less</span><span class=o>&lt;</span><span class=kt>key_t</span><span class=o>>></span>
<span class=k>struct</span><span class=w> </span><span class=nc>rb_tree</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Tree node</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>struct</span><span class=w> </span><span class=nc>node_t</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=n>fa</span><span class=p>;</span><span class=w>     </span><span class=c1>// == nullptr if root of the tree, otherwise parent</span>
<span class=w>    </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=n>ch</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span><span class=w>  </span><span class=c1>// == nullptr if child is empty</span>
<span class=w>                    </span><span class=c1>// ch[0]: left child, ch[1]: right child</span>
<span class=w>    </span><span class=kt>key_t</span><span class=w> </span><span class=n>data</span><span class=p>;</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>sz</span><span class=p>;</span><span class=w>  </span><span class=c1>// Size of subtree</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>red</span><span class=p>;</span><span class=w>   </span><span class=c1>// == true if node is red, otherwise black</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * Get child direction of current non-null node</span>
<span class=cm>     *</span>
<span class=cm>     * @return true if this node is right child of its parent, otherwise false</span>
<span class=cm>     */</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>child_dir</span><span class=p>()</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>fa</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span><span class=w> </span><span class=p>}</span>
<span class=w>  </span><span class=p>};</span>

<span class=w>  </span><span class=k>using</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=p>;</span>
<span class=w>  </span><span class=k>using</span><span class=w> </span><span class=n>const_pointer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=p>;</span>
<span class=w>  </span><span class=k>using</span><span class=w> </span><span class=n>pointer_const</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=p>;</span>

<span class=w>  </span><span class=k>const</span><span class=w> </span><span class=n>compare_t</span><span class=w> </span><span class=n>compare</span><span class=p>;</span>
<span class=w>  </span><span class=n>pointer</span><span class=w> </span><span class=n>root</span><span class=p>;</span>

<span class=w>  </span><span class=n>rb_tree</span><span class=p>()</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>compare</span><span class=p>{},</span><span class=w> </span><span class=n>root</span><span class=p>{</span><span class=k>nullptr</span><span class=p>}</span><span class=w> </span><span class=p>{}</span>

<span class=w>  </span><span class=c1>// ...</span>
<span class=p>};</span>
</code></pre></div></td></tr></table></div><details class=note open><summary>Note</summary> <p>在红黑树节点的存储中，用数组来存储子节点指针可以提高代码复用率．</p></details><h2 data-original-document-end=1170 data-original-document-start=1165 id=操作>操作<a title="Permanent link" class=headerlink href=#操作></a></h2><details class=note open><summary>Note</summary> <p>红黑树的插入/删除有多种实现方式，本文采用《算法导论》的实现方式，将插入后的平衡维护分为 3 种情况，删除后的平衡维护分为 4 种情况．</p></details><p data-original-document-end=1340 data-original-document-start=1263>红黑树的遍历、查找最小/最大值、搜索元素、求元素的排名、根据排名反查元素、查找前驱/后继等操作和 <a href=../bst/>二叉搜索树</a> 一致，此处不再赘述．</p><p data-original-document-end=1372 data-original-document-start=1342>另外，在下文插入/删除平衡维护的代码注释中，我们作如下约定：</p><ul data-original-document-end=1489 data-original-document-start=1374><li>用 <code>p</code> 表示节点 <code>p</code> 为黑色；</li><li>用 <code>[p]</code> 表示节点 <code>p</code> 为红色；</li><li>用 <code>{p}</code> 表示节点 <code>p</code> 为红色或黑色；</li><li>用 <code>|p|</code> 表示节点 <code>p</code> 为 NIL 节点或颜色为黑色．</li></ul><h3 data-original-document-end=1497 data-original-document-start=1491 id=旋转>旋转<a title="Permanent link" class=headerlink href=#旋转></a></h3><p data-original-document-end=1554 data-original-document-start=1499>旋转操作是多数平衡树能够维持平衡的关键，它能在不改变一棵合法 BST 中序遍历结果的情况下改变局部节点的深度．</p><p data-original-document-end=1601 data-original-document-start=1556><img alt=rbtree-rotations src=../images/rbtree-rotate.svg></p><details class=note data-original-document-end=1687 data-original-document-start=1603 open><summary>实现</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @param p root of subtree (may be same as {@code root})</span>
<span class=cm>   * @param dir direction. 0: left rotate; 1: right rotate</span>
<span class=cm>   * @return new root of subtree</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>rotate</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>dir</span><span class=p>];</span><span class=w>  </span><span class=c1>// new root of subtree</span>
<span class=w>    </span><span class=n>assert</span><span class=p>(</span><span class=n>s</span><span class=p>);</span><span class=w>             </span><span class=c1>// pointer to true node required</span>
<span class=w>    </span><span class=n>s</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>sz</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>])</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>])</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>];</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>c</span><span class=p>)</span><span class=w> </span><span class=n>c</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>dir</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>c</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>g</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>g</span><span class=p>)</span>
<span class=w>      </span><span class=n>g</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>p</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>g</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=k>else</span>
<span class=w>      </span><span class=n>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
</code></pre></div></td></tr></table></div></details><h3 data-original-document-end=1695 data-original-document-start=1689 id=插入>插入<a title="Permanent link" class=headerlink href=#插入></a></h3><p data-original-document-end=1774 data-original-document-start=1697>红黑树的插入操作与普通的 BST 类似，对于红黑树来说，新插入的节点初始为红色，完成插入后需根据插入节点及相关节点的状态进行修正以满足上文提到的四条性质．</p><details class=note open><summary>实现</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @return nullptr if insert failed, otherwise pointer of inserted node</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>insert</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>const_pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>pointer</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>node_t</span><span class=p>;</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=n>pointer</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=p>;</span>
<span class=w>      </span><span class=n>dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>compare</span><span class=p>(</span><span class=n>now</span><span class=o>-></span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=p>);</span>
<span class=w>      </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>];</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>insert_fixup_leaf</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>dir</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>n</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Insert leaf node {@code n} to {@code p}</span>
<span class=cm>   *</span>
<span class=cm>   * @param p parent of node which will be inserted</span>
<span class=cm>   * @param n leaf node which will be inserted</span>
<span class=cm>   * @param dir direction of n, 0: left; 1: right</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>insert_leaf</span><span class=p>(</span><span class=n>pointer_const</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>pointer_const</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=n>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=p>;</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>sz</span><span class=o>++</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Insert leaf node {@code n} to {@code p}, then fixup</span>
<span class=cm>   *</span>
<span class=cm>   * @param p parent of node which will be inserted</span>
<span class=cm>   * @param n node which will be inserted</span>
<span class=cm>   * @param dir direction of n, 0: left; 1: right</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>insert_fixup_leaf</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=n>insert_leaf</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>dir</span><span class=p>);</span>
<span class=w>    </span><span class=c1>// Fix double red</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=w>    </span><span class=c1>// Post process: color root black</span>
<span class=w>    </span><span class=n>root</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
</code></pre></div></td></tr></table></div></details><h3 id=插入后的平衡维护>插入后的平衡维护<a title="Permanent link" class=headerlink href=#插入后的平衡维护></a></h3><details class=note open><summary>Note</summary> <p>为加深理解，请读者自行验证平衡维护后是否满足性质 4．</p></details><p data-original-document-end=2154 data-original-document-start=2113>由于插入的节点若不为根节点则必为红色，所以插入后可能违反性质 3，需要维护平衡性．</p><p data-original-document-end=2215 data-original-document-start=2156>令插入的节点为 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container>，其父节点为 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container>，祖父节点为 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=g><mjx-mi data-latex=g><mjx-c class=mjx-c1D454>𝑔</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=g xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=g>g</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=g></mjx-container>，叔节点为 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=u><mjx-mi data-latex=u><mjx-c class=mjx-c1D462>𝑢</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=u xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=u>u</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=u></mjx-container>．由性质 3 可知 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=g><mjx-mi data-latex=g><mjx-c class=mjx-c1D454>𝑔</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=g xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=g>g</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=g></mjx-container> 必为黑色．</p><p data-original-document-end=2259 data-original-document-start=2217>我们从插入的位置开始向上递归维护，若 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 为黑色即可终止，否则分为 3 种情况．</p><p data-original-document-end=2388 data-original-document-start=2261></p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>is_red</span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=kt>bool</span><span class=w> </span><span class=n>p_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>child_dir</span><span class=p>();</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=p>,</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>g</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>p_dir</span><span class=p>];</span>
<span class=w>      </span><span class=c1>// ...</span>
<span class=w>    </span><span class=p>}</span>
</code></pre></div></td></tr></table></div><h4 data-original-document-end=2408 data-original-document-start=2390 id=insert-case-1>Insert case 1<a title="Permanent link" class=headerlink href=#insert-case-1></a></h4><p data-original-document-end=2438 data-original-document-start=2410><mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 和 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=u><mjx-mi data-latex=u><mjx-c class=mjx-c1D462>𝑢</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=u xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=u>u</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=u></mjx-container> 均为红色．此时我们只需重新染色即可．</p><p data-original-document-end=2475 data-original-document-start=2440><img alt src=../images/rbtree-insert-case1.svg></p><details class=note open><summary>实现</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>      </span><span class=c1>// Case 1: both p and u are red</span>
<span class=w>      </span><span class=c1>//      g              [g]</span>
<span class=w>      </span><span class=c1>//     / \             / \</span>
<span class=c1>      //   [p] [u]   ==>    p   u</span>
<span class=w>      </span><span class=c1>//   /               /</span>
<span class=w>      </span><span class=c1>// [n]             [n]</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>is_red</span><span class=p>(</span><span class=n>u</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>u</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>        </span><span class=n>g</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>g</span><span class=p>;</span>
<span class=w>        </span><span class=k>continue</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
</code></pre></div></td></tr></table></div></details><h4 data-original-document-end=2587 data-original-document-start=2569 id=insert-case-2>Insert case 2<a title="Permanent link" class=headerlink href=#insert-case-2></a></h4><p data-original-document-end=2624 data-original-document-start=2589><mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 为红色，<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=u><mjx-mi data-latex=u><mjx-c class=mjx-c1D462>𝑢</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=u xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=u>u</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=u></mjx-container> 为黑色，<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 的方向和 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 的方向不同．</p><p data-original-document-end=2650 data-original-document-start=2626>此时我们需要旋转 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 节点来转为第三种情况．</p><p data-original-document-end=2687 data-original-document-start=2652><img alt src=../images/rbtree-insert-case2.svg></p><details class=note open><summary>实现</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>      </span><span class=c1>// p is red and u is black</span>
<span class=w>      </span><span class=c1>// Case 2: dir of n is different with dir of p</span>
<span class=w>      </span><span class=c1>//    g              g</span>
<span class=w>      </span><span class=c1>//   / \            / \</span>
<span class=c1>      // [p]  u   ==>   [n]  u</span>
<span class=w>      </span><span class=c1>//   \            /</span>
<span class=w>      </span><span class=c1>//   [n]        [p]</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>p_dir</span><span class=p>)</span><span class=w> </span><span class=n>rotate</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>p_dir</span><span class=p>),</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>swap</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=p>);</span>
</code></pre></div></td></tr></table></div></details><h4 data-original-document-end=2799 data-original-document-start=2781 id=insert-case-3>Insert case 3<a title="Permanent link" class=headerlink href=#insert-case-3></a></h4><p data-original-document-end=2836 data-original-document-start=2801><mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 为红色，<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=u><mjx-mi data-latex=u><mjx-c class=mjx-c1D462>𝑢</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=u xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=u>u</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=u></mjx-container> 为黑色，<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 的方向和 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 的方向相同．</p><p data-original-document-end=2888 data-original-document-start=2838>此时我们需要旋转 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=g><mjx-mi data-latex=g><mjx-c class=mjx-c1D454>𝑔</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=g xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=g>g</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=g></mjx-container> 节点以将 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 转为子树的根，之后交换 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 和 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=g><mjx-mi data-latex=g><mjx-c class=mjx-c1D454>𝑔</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=g xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=g>g</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=g></mjx-container> 的颜色即可．</p><p data-original-document-end=2925 data-original-document-start=2890><img alt src=../images/rbtree-insert-case3.svg></p><details class=note open><summary>实现</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>      </span><span class=c1>// Case 3: p is red, u is black and dir of n is same as dir of p</span>
<span class=w>      </span><span class=c1>//      g             p</span>
<span class=w>      </span><span class=c1>//     / \           / \</span>
<span class=c1>      //   [p]  u   ==>  [n] [g]</span>
<span class=w>      </span><span class=c1>//   /                   \</span>
<span class=c1>      // [n]                    u</span>
<span class=w>      </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span><span class=w> </span><span class=n>g</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>      </span><span class=n>rotate</span><span class=p>(</span><span class=n>g</span><span class=p>,</span><span class=w> </span><span class=o>!</span><span class=n>p_dir</span><span class=p>);</span>
</code></pre></div></td></tr></table></div></details><h3 data-original-document-end=3025 data-original-document-start=3019 id=删除>删除<a title="Permanent link" class=headerlink href=#删除></a></h3><p data-original-document-end=3058 data-original-document-start=3027>红黑树的删除操作与普通的 BST 相比要多一些步骤．具体而言：</p><ul data-original-document-end=3357 data-original-document-start=3060><li>若待删除的节点 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 有两个子节点，则交换 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 和右子树中最小节点 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 的数据，并将 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 设为 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container>．此时 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 不可能有两个子节点．</li><li>若待删除的节点 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 有一个子节点 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container>．由性质 4 可知 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 必为红色，再由性质 3 可知 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 必为黑色．所以只需将 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 在父节点 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 中对应的指针替换为 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 的地址，以及将 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 的父节点指针替换为 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 的地址，之后再将 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 染黑即可．</li><li>若待删除的节点 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 没有子节点．若 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 是根节点或 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 是红色节点，则直接删除即可，否则直接删除会违反性质 4，需要维护平衡性．</li></ul><details class=note open><summary>实现</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @return succeed or not</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>erase</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lower_bound</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>data</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>    </span><span class=n>erase</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @return {@code next(p)}</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>erase</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>const_pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=n>pointer</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>leftmost</span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
<span class=w>      </span><span class=n>std</span><span class=o>::</span><span class=n>swap</span><span class=p>(</span><span class=n>s</span><span class=o>-></span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>data</span><span class=p>);</span>
<span class=w>      </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span>
<span class=w>      </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>next</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
<span class=w>    </span><span class=n>erase_fixup_branch_or_leaf</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
<span class=w>    </span><span class=k>delete</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Erase node {@code n}</span>
<span class=cm>   *</span>
<span class=cm>   * @param n node which will be deleted, must have no more than 2 child</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>erase_branch_or_leaf</span><span class=p>(</span><span class=n>pointer_const</span><span class=w> </span><span class=n>n</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=n>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>()]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>sz</span><span class=o>--</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Erase node {@code n}, then fixup</span>
<span class=cm>   *</span>
<span class=cm>   * @param n node which will be deleted, must have no more than 2 child</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>erase_fixup_branch_or_leaf</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>n</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>n_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>root</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nb>false</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>();</span>
<span class=w>    </span><span class=n>erase_branch_or_leaf</span><span class=p>(</span><span class=n>n</span><span class=p>);</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// n is root</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=n>root</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// n has 1 child</span>
<span class=w>        </span><span class=c1>// n must be black and s must be red, so we need to color s black</span>
<span class=w>        </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>        </span><span class=k>return</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=c1>// n is not root but leaf with black color, need to be fixup</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=w>    </span><span class=c1>// Post process: see case 2 & case 4</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
</code></pre></div></td></tr></table></div></details><h3 id=删除后的平衡维护>删除后的平衡维护<a title="Permanent link" class=headerlink href=#删除后的平衡维护></a></h3><details class=note open><summary>Note</summary> <p>为加深理解，请读者自行验证平衡维护后是否满足性质 4．</p></details><p data-original-document-end=3767 data-original-document-start=3696>由上文讨论可知 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 是黑色叶子节点且不为根节点．我们设 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 的父节点为 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container>，兄弟节点为 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container>，侄节点分别为 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=c><mjx-mi data-latex=c><mjx-c class=mjx-c1D450>𝑐</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=c xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=c>c</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=c></mjx-container> 和 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=d><mjx-mi data-latex=d><mjx-c class=mjx-c1D451>𝑑</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=d xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=d>d</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=d></mjx-container>．</p><p data-original-document-end=3824 data-original-document-start=3769>删除的维护也是从 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 开始向上递归维护，若 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 是根或 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=n><mjx-mi data-latex=n><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=n xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=n>n</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=n></mjx-container> 为红色即可终止，否则分为 4 种情况．</p><p data-original-document-end=4062 data-original-document-start=3826></p><div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=o>!</span><span class=n>n</span><span class=o>-></span><span class=n>red</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=c1>// Delete case 1</span>
<span class=w>      </span><span class=c1>// ...</span>
<span class=w>      </span><span class=c1>// Other cases</span>
<span class=w>      </span><span class=c1>// s must be black</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n_dir</span><span class=p>],</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=c1>// ...</span>
<span class=w>    </span><span class=nl>end_erase_fixup</span><span class=p>:</span>
<span class=w>      </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=n>n_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span>
</code></pre></div></td></tr></table></div><h4 data-original-document-end=4082 data-original-document-start=4064 id=delete-case-1>Delete case 1<a title="Permanent link" class=headerlink href=#delete-case-1></a></h4><p data-original-document-end=4092 data-original-document-start=4084><mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 为红色．</p><p data-original-document-end=4149 data-original-document-start=4094>此时我们旋转 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container>，将 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 转为子树根节点，之后交换 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 和 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 的颜色来转为其余三种情况之一．</p><p data-original-document-end=4186 data-original-document-start=4151><img alt src=../images/rbtree-remove-case1.svg></p><details class=note open><summary>实现</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>      </span><span class=c1>// Case 1: s is red</span>
<span class=w>      </span><span class=c1>//    p               s</span>
<span class=w>      </span><span class=c1>//   / \             / \</span>
<span class=c1>      // |n| [s]   ==>   [p]  d</span>
<span class=w>      </span><span class=c1>//     / \         / \</span>
<span class=c1>      //    c   d      |n|  c</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>is_red</span><span class=p>(</span><span class=n>s</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>rotate</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n_dir</span><span class=p>);</span>
<span class=w>        </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=p>}</span>
</code></pre></div></td></tr></table></div></details><h4 data-original-document-end=4298 data-original-document-start=4280 id=delete-case-2>Delete case 2<a title="Permanent link" class=headerlink href=#delete-case-2></a></h4><p data-original-document-end=4328 data-original-document-start=4300><mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 的颜色不确定，<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container>、<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=c><mjx-mi data-latex=c><mjx-c class=mjx-c1D450>𝑐</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=c xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=c>c</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=c></mjx-container>、<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=d><mjx-mi data-latex=d><mjx-c class=mjx-c1D451>𝑑</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=d xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=d>d</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=d></mjx-container> 均为黑色．</p><p data-original-document-end=4345 data-original-document-start=4330>此时只需将 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 染红即可．</p><p data-original-document-end=4382 data-original-document-start=4347><img alt src=../images/rbtree-remove-case2.svg></p><p data-original-document-end=4441 data-original-document-start=4384>需要注意的是，若 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 为红色则会违反性质 3，但是若 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 为红色则会直接退出循环，所以我们在最后将其染黑．</p><details class=note open><summary>实现</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>      </span><span class=c1>// Case 2: both c and d are black</span>
<span class=w>      </span><span class=c1>//   {p}          {p}</span>
<span class=w>      </span><span class=c1>//   / \          / \</span>
<span class=c1>      // |n|  s   ==> |n| [s]</span>
<span class=w>      </span><span class=c1>//     / \          / \</span>
<span class=c1>      //    c   d        c   d</span>
<span class=w>      </span><span class=c1>// p will be colored black in the end</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>is_red</span><span class=p>(</span><span class=n>c</span><span class=p>)</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=o>!</span><span class=n>is_red</span><span class=p>(</span><span class=n>d</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>        </span><span class=k>goto</span><span class=w> </span><span class=n>end_erase_fixup</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
</code></pre></div></td></tr></table></div></details><h4 data-original-document-end=4553 data-original-document-start=4535 id=delete-case-3>Delete case 3<a title="Permanent link" class=headerlink href=#delete-case-3></a></h4><p data-original-document-end=4587 data-original-document-start=4555><mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 的颜色不确定，<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container>、<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=d><mjx-mi data-latex=d><mjx-c class=mjx-c1D451>𝑑</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=d xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=d>d</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=d></mjx-container> 均为黑色，<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=c><mjx-mi data-latex=c><mjx-c class=mjx-c1D450>𝑐</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=c xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=c>c</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=c></mjx-container> 为红色．</p><p data-original-document-end=4650 data-original-document-start=4589>此时需要旋转 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 使 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=c><mjx-mi data-latex=c><mjx-c class=mjx-c1D450>𝑐</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=c xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=c>c</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=c></mjx-container> 为原来 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 对应子树的根节点，并交换 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 和 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=c><mjx-mi data-latex=c><mjx-c class=mjx-c1D450>𝑐</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=c xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=c>c</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=c></mjx-container> 的颜色转为第四种情况即可．</p><p data-original-document-end=4687 data-original-document-start=4652><img alt src=../images/rbtree-remove-case3.svg></p><details class=note open><summary>实现</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>      </span><span class=c1>// Case 3: c is red and d is black</span>
<span class=w>      </span><span class=c1>//   {p}          {p}</span>
<span class=w>      </span><span class=c1>//   / \          / \</span>
<span class=c1>      // |n|  s   ==> |n|  c</span>
<span class=w>      </span><span class=c1>//     / \            \</span>
<span class=c1>      //   [c]  d           [s]</span>
<span class=w>      </span><span class=c1>//                      \</span>
<span class=c1>      //                       d</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>is_red</span><span class=p>(</span><span class=n>d</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>c</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>rotate</span><span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=o>!</span><span class=n>n_dir</span><span class=p>);</span>
<span class=w>        </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>],</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n_dir</span><span class=p>],</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=p>}</span>
</code></pre></div></td></tr></table></div></details><h4 data-original-document-end=4799 data-original-document-start=4781 id=delete-case-4>Delete case 4<a title="Permanent link" class=headerlink href=#delete-case-4></a></h4><p data-original-document-end=4832 data-original-document-start=4801><mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container>、<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=c><mjx-mi data-latex=c><mjx-c class=mjx-c1D450>𝑐</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=c xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=c>c</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=c></mjx-container> 的颜色不确定，<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 为黑色，<mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=d><mjx-mi data-latex=d><mjx-c class=mjx-c1D451>𝑑</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=d xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=d>d</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=d></mjx-container> 为红色．</p><p data-original-document-end=4894 data-original-document-start=4834>此时需要旋转 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 使 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 为子树的根节点，交换 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=s><mjx-mi data-latex=s><mjx-c class=mjx-c1D460>𝑠</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=s xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=s>s</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=s></mjx-container> 和 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=p><mjx-mi data-latex=p><mjx-c class=mjx-c1D45D>𝑝</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=p xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=p>p</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=p></mjx-container> 的颜色，并将 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math aria-hidden=true class=NCM-N data-latex=d><mjx-mi data-latex=d><mjx-c class=mjx-c1D451>𝑑</mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex=d xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=d>d</mi></math></mjx-assistive-mml><img src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 title=d></mjx-container> 染黑即可终止维护平衡．</p><p data-original-document-end=4931 data-original-document-start=4896><img alt src=../images/rbtree-remove-case4.svg></p><details class=note open><summary>实现</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=w>      </span><span class=c1>// Case 4: d is red</span>
<span class=w>      </span><span class=c1>//   {p}            {s}</span>
<span class=w>      </span><span class=c1>//   / \            / \</span>
<span class=c1>      // |n|  s   ==>    p   d</span>
<span class=w>      </span><span class=c1>//     / \        / \</span>
<span class=c1>      //   {c} [d]    |n| {c}</span>
<span class=w>      </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>      </span><span class=n>rotate</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n_dir</span><span class=p>),</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span>
</code></pre></div></td></tr></table></div></details><h2 data-original-document-end=5032 data-original-document-start=5025 id=参考代码>参考代码<a title="Permanent link" class=headerlink href=#参考代码></a></h2><p data-original-document-end=5052 data-original-document-start=5034>下面的代码是用红黑树实现的 set：</p><details class=note data-original-document-end=5135 data-original-document-start=5054><summary>实现</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>  1</span>
<span class=normal>  2</span>
<span class=normal>  3</span>
<span class=normal>  4</span>
<span class=normal>  5</span>
<span class=normal>  6</span>
<span class=normal>  7</span>
<span class=normal>  8</span>
<span class=normal>  9</span>
<span class=normal> 10</span>
<span class=normal> 11</span>
<span class=normal> 12</span>
<span class=normal> 13</span>
<span class=normal> 14</span>
<span class=normal> 15</span>
<span class=normal> 16</span>
<span class=normal> 17</span>
<span class=normal> 18</span>
<span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span></pre></div></td><td class=code><div><pre><span></span><code><span class=cm>/**</span>
<span class=cm> * @file rbtree.hpp</span>
<span class=cm> * @brief An RBTree-based set implementation</span>
<span class=cm> * @details The set is sorted according to the {@code compare_t} function</span>
<span class=cm> * provided; This implementation provides find, insert, remove, find order, find</span>
<span class=cm> * key by order in O(log(n)) time.</span>
<span class=cm> * @author [Tiphereth-A](https://github.com/Tiphereth-A)</span>
<span class=cm> */</span>

<span class=cp>#ifndef RBTREE_HPP</span>
<span class=cp>#define RBTREE_HPP</span>

<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;cassert></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;cstdint></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;functional></span>

<span class=k>using</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=kt>size_t</span><span class=p>;</span>

<span class=cm>/**</span>
<span class=cm> * An RBTree-based set implementation</span>
<span class=cm> *</span>
<span class=cm> * @tparam key_t key type</span>
<span class=cm> * @tparam compare_t compare function</span>
<span class=cm> */</span>
<span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>key_t</span><span class=p>,</span><span class=w> </span><span class=k>typename</span><span class=w> </span><span class=nc>compare_t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>less</span><span class=o>&lt;</span><span class=kt>key_t</span><span class=o>>></span>
<span class=k>struct</span><span class=w> </span><span class=nc>rb_tree</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Tree node</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>struct</span><span class=w> </span><span class=nc>node_t</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=n>fa</span><span class=p>;</span><span class=w>     </span><span class=c1>// == nullptr if root of the tree, otherwise parent</span>
<span class=w>    </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=n>ch</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span><span class=w>  </span><span class=c1>// == nullptr if child is empty</span>
<span class=w>                    </span><span class=c1>// ch[0]: left child, ch[1]: right child</span>
<span class=w>    </span><span class=kt>key_t</span><span class=w> </span><span class=n>data</span><span class=p>;</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>sz</span><span class=p>;</span><span class=w>  </span><span class=c1>// Size of subtree</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>red</span><span class=p>;</span><span class=w>   </span><span class=c1>// == true if node is red, otherwise black</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * Get child direction of current non-null node</span>
<span class=cm>     *</span>
<span class=cm>     * @return true if this node is right child of its parent, otherwise false</span>
<span class=cm>     */</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>child_dir</span><span class=p>()</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>fa</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span><span class=w> </span><span class=p>}</span>
<span class=w>  </span><span class=p>};</span>

<span class=w>  </span><span class=k>using</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=p>;</span>
<span class=w>  </span><span class=k>using</span><span class=w> </span><span class=n>const_pointer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=p>;</span>
<span class=w>  </span><span class=k>using</span><span class=w> </span><span class=n>pointer_const</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=p>;</span>

<span class=w>  </span><span class=k>const</span><span class=w> </span><span class=n>compare_t</span><span class=w> </span><span class=n>compare</span><span class=p>;</span>
<span class=w>  </span><span class=n>pointer</span><span class=w> </span><span class=n>root</span><span class=p>;</span>

<span class=w>  </span><span class=n>rb_tree</span><span class=p>()</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>compare</span><span class=p>{},</span><span class=w> </span><span class=n>root</span><span class=p>{</span><span class=k>nullptr</span><span class=p>}</span><span class=w> </span><span class=p>{}</span>


<span class=w>  </span><span class=o>~</span><span class=n>rb_tree</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>post_order</span><span class=p>([](</span><span class=k>auto</span><span class=w> </span><span class=n>it</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>delete</span><span class=w> </span><span class=n>it</span><span class=p>;</span><span class=w> </span><span class=p>});</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>size</span><span class=p>()</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>root</span><span class=p>);</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>F</span><span class=o>></span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>pre_order</span><span class=p>(</span><span class=n>F</span><span class=w> </span><span class=n>callback</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=o>&</span><span class=p>](</span><span class=k>auto</span><span class=w> </span><span class=o>&&</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span>
<span class=w>      </span><span class=n>callback</span><span class=p>(</span><span class=n>p</span><span class=p>),</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
<span class=w>    </span><span class=p>};</span>
<span class=w>    </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>root</span><span class=p>);</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>F</span><span class=o>></span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>in_order</span><span class=p>(</span><span class=n>F</span><span class=w> </span><span class=n>callback</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=o>&</span><span class=p>](</span><span class=k>auto</span><span class=w> </span><span class=o>&&</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span>
<span class=w>      </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span><span class=w> </span><span class=n>callback</span><span class=p>(</span><span class=n>p</span><span class=p>),</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
<span class=w>    </span><span class=p>};</span>
<span class=w>    </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>root</span><span class=p>);</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>F</span><span class=o>></span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>post_order</span><span class=p>(</span><span class=n>F</span><span class=w> </span><span class=n>callback</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=o>&</span><span class=p>](</span><span class=k>auto</span><span class=w> </span><span class=o>&&</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span>
<span class=w>      </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]),</span><span class=w> </span><span class=n>callback</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
<span class=w>    </span><span class=p>};</span>
<span class=w>    </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>root</span><span class=p>);</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>leftmost</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>most</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>rightmost</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>most</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>prev</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>neighbour</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>next</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>neighbour</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>lower_bound</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>const_pointer</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>,</span><span class=w> </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>compare</span><span class=p>(</span><span class=n>now</span><span class=o>-></span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>))</span>
<span class=w>        </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
<span class=w>      </span><span class=k>else</span>
<span class=w>        </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>pointer</span><span class=p>)</span><span class=n>ans</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>upper_bound</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>const_pointer</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>,</span><span class=w> </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>compare</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>data</span><span class=p>))</span>
<span class=w>        </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
<span class=w>      </span><span class=k>else</span>
<span class=w>        </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>pointer</span><span class=p>)</span><span class=n>ans</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=c1>// Order start from 0</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>order_of_key</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>compare</span><span class=p>(</span><span class=n>now</span><span class=o>-></span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>))</span>
<span class=w>        </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
<span class=w>      </span><span class=k>else</span>
<span class=w>        </span><span class=n>ans</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ans</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=c1>// Order start from 0</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>find_by_order</span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>order</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>const_pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>const_pointer</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>,</span><span class=w> </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>>=</span><span class=w> </span><span class=n>order</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>lsize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>order</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>lsize</span><span class=p>)</span>
<span class=w>        </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
<span class=w>      </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=p>;</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>order</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>lsize</span><span class=p>)</span><span class=w> </span><span class=k>break</span><span class=p>;</span>
<span class=w>        </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=n>lsize</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ans</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @return nullptr if insert failed, otherwise pointer of inserted node</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>insert</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>const_pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>pointer</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>node_t</span><span class=p>;</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=n>pointer</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=p>;</span>
<span class=w>      </span><span class=n>dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>compare</span><span class=p>(</span><span class=n>now</span><span class=o>-></span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=p>);</span>
<span class=w>      </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>];</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>insert_fixup_leaf</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>dir</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>n</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @return succeed or not</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>erase</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lower_bound</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>data</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>    </span><span class=n>erase</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @return {@code next(p)}</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>erase</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>const_pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=n>pointer</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>leftmost</span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
<span class=w>      </span><span class=n>std</span><span class=o>::</span><span class=n>swap</span><span class=p>(</span><span class=n>s</span><span class=o>-></span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>data</span><span class=p>);</span>
<span class=w>      </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span>
<span class=w>      </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>next</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
<span class=w>    </span><span class=n>erase_fixup_branch_or_leaf</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
<span class=w>    </span><span class=k>delete</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w> </span><span class=k>private</span><span class=o>:</span>
<span class=w>  </span><span class=k>static</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>static</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>is_red</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nb>false</span><span class=p>;</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @param dir 0: leftmost, 1: rightmost</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>most</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>])</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>];</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>pointer</span><span class=p>)</span><span class=n>p</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @param dir 0: prev, 1: next</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>neighbour</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>])</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>most</span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>],</span><span class=w> </span><span class=o>!</span><span class=n>dir</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>child_dir</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Insert leaf node {@code n} to {@code p}</span>
<span class=cm>   *</span>
<span class=cm>   * @param p parent of node which will be inserted</span>
<span class=cm>   * @param n leaf node which will be inserted</span>
<span class=cm>   * @param dir direction of n, 0: left; 1: right</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>insert_leaf</span><span class=p>(</span><span class=n>pointer_const</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>pointer_const</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=n>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=p>;</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>sz</span><span class=o>++</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Erase node {@code n}</span>
<span class=cm>   *</span>
<span class=cm>   * @param n node which will be deleted, must have no more than 2 child</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>erase_branch_or_leaf</span><span class=p>(</span><span class=n>pointer_const</span><span class=w> </span><span class=n>n</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=n>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>()]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>sz</span><span class=o>--</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @param p root of subtree (may be same as {@code root})</span>
<span class=cm>   * @param dir direction. 0: left rotate; 1: right rotate</span>
<span class=cm>   * @return new root of subtree</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>rotate</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>dir</span><span class=p>];</span><span class=w>  </span><span class=c1>// new root of subtree</span>
<span class=w>    </span><span class=n>assert</span><span class=p>(</span><span class=n>s</span><span class=p>);</span><span class=w>             </span><span class=c1>// pointer to true node required</span>
<span class=w>    </span><span class=n>s</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>sz</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>])</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>])</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>];</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>c</span><span class=p>)</span><span class=w> </span><span class=n>c</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>dir</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>c</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>g</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>g</span><span class=p>)</span>
<span class=w>      </span><span class=n>g</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>p</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>g</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=k>else</span>
<span class=w>      </span><span class=n>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=cp>#pragma GCC diagnostic ignored "-Wcomment"</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Insert leaf node {@code n} to {@code p}, then fixup</span>
<span class=cm>   *</span>
<span class=cm>   * @param p parent of node which will be inserted</span>
<span class=cm>   * @param n node which will be inserted</span>
<span class=cm>   * @param dir direction of n, 0: left; 1: right</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>insert_fixup_leaf</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=n>insert_leaf</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>dir</span><span class=p>);</span>
<span class=w>    </span><span class=c1>// Fix double red</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>is_red</span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=kt>bool</span><span class=w> </span><span class=n>p_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>child_dir</span><span class=p>();</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=p>,</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>g</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>p_dir</span><span class=p>];</span>
<span class=w>      </span><span class=c1>// Case 1: both p and u are red</span>
<span class=w>      </span><span class=c1>//      g              [g]</span>
<span class=w>      </span><span class=c1>//     / \             / \</span>
<span class=c1>      //   [p] [u]   ==>    p   u</span>
<span class=w>      </span><span class=c1>//   /               /</span>
<span class=w>      </span><span class=c1>// [n]             [n]</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>is_red</span><span class=p>(</span><span class=n>u</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>u</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>        </span><span class=n>g</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>g</span><span class=p>;</span>
<span class=w>        </span><span class=k>continue</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=c1>// p is red and u is black</span>
<span class=w>      </span><span class=c1>// Case 2: dir of n is different with dir of p</span>
<span class=w>      </span><span class=c1>//    g              g</span>
<span class=w>      </span><span class=c1>//   / \            / \</span>
<span class=c1>      // [p]  u   ==>   [n]  u</span>
<span class=w>      </span><span class=c1>//   \            /</span>
<span class=w>      </span><span class=c1>//   [n]        [p]</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>p_dir</span><span class=p>)</span><span class=w> </span><span class=n>rotate</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>p_dir</span><span class=p>),</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>swap</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=p>);</span>
<span class=w>      </span><span class=c1>// Case 3: p is red, u is black and dir of n is same as dir of p</span>
<span class=w>      </span><span class=c1>//      g             p</span>
<span class=w>      </span><span class=c1>//     / \           / \</span>
<span class=c1>      //   [p]  u   ==>  [n] [g]</span>
<span class=w>      </span><span class=c1>//   /                   \</span>
<span class=c1>      // [n]                    u</span>
<span class=w>      </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span><span class=w> </span><span class=n>g</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>      </span><span class=n>rotate</span><span class=p>(</span><span class=n>g</span><span class=p>,</span><span class=w> </span><span class=o>!</span><span class=n>p_dir</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=c1>// Post process: color root black</span>
<span class=w>    </span><span class=n>root</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Erase node {@code n}, then fixup</span>
<span class=cm>   *</span>
<span class=cm>   * @param n node which will be deleted, must have no more than 2 child</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>erase_fixup_branch_or_leaf</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>n</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>n_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>root</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nb>false</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>();</span>
<span class=w>    </span><span class=n>erase_branch_or_leaf</span><span class=p>(</span><span class=n>n</span><span class=p>);</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// n is root</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=n>root</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// n has 1 child</span>
<span class=w>        </span><span class=c1>// n must be black and s must be red, so we need to color s black</span>
<span class=w>        </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>        </span><span class=k>return</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=c1>// n is not root but leaf with black color, need to be fixup</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=o>!</span><span class=n>n</span><span class=o>-></span><span class=n>red</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=c1>// Case 1: s is red</span>
<span class=w>      </span><span class=c1>//    p               s</span>
<span class=w>      </span><span class=c1>//   / \             / \</span>
<span class=c1>      // |n| [s]   ==>   [p]  d</span>
<span class=w>      </span><span class=c1>//     / \         / \</span>
<span class=c1>      //    c   d      |n|  c</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>is_red</span><span class=p>(</span><span class=n>s</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>rotate</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n_dir</span><span class=p>);</span>
<span class=w>        </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=c1>// s must be black</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n_dir</span><span class=p>],</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=c1>// Case 2: both c and d are black</span>
<span class=w>      </span><span class=c1>//   {p}          {p}</span>
<span class=w>      </span><span class=c1>//   / \          / \</span>
<span class=c1>      // |n|  s   ==> |n| [s]</span>
<span class=w>      </span><span class=c1>//     / \          / \</span>
<span class=c1>      //    c   d        c   d</span>
<span class=w>      </span><span class=c1>// p will be colored black in the end</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>is_red</span><span class=p>(</span><span class=n>c</span><span class=p>)</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=o>!</span><span class=n>is_red</span><span class=p>(</span><span class=n>d</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>        </span><span class=k>goto</span><span class=w> </span><span class=n>end_erase_fixup</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=c1>// Case 3: c is red and d is black</span>
<span class=w>      </span><span class=c1>//   {p}          {p}</span>
<span class=w>      </span><span class=c1>//   / \          / \</span>
<span class=c1>      // |n|  s   ==> |n|  c</span>
<span class=w>      </span><span class=c1>//     / \            \</span>
<span class=c1>      //   [c]  d           [s]</span>
<span class=w>      </span><span class=c1>//                      \</span>
<span class=c1>      //                       d</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>is_red</span><span class=p>(</span><span class=n>d</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>c</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>rotate</span><span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=o>!</span><span class=n>n_dir</span><span class=p>);</span>
<span class=w>        </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>],</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n_dir</span><span class=p>],</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=c1>// Case 4: d is red</span>
<span class=w>      </span><span class=c1>//   {p}            {s}</span>
<span class=w>      </span><span class=c1>//   / \            / \</span>
<span class=c1>      // |n|  s   ==>    p   d</span>
<span class=w>      </span><span class=c1>//     / \        / \</span>
<span class=c1>      //   {c} [d]    |n| {c}</span>
<span class=w>      </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>      </span><span class=n>rotate</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n_dir</span><span class=p>),</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span>
<span class=w>    </span><span class=nl>end_erase_fixup</span><span class=p>:</span>
<span class=w>      </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=n>n_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=c1>// Post process: see case 2 & case 4</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=p>};</span>

<span class=cp>#pragma GCC diagnostic warning "-Wcomment"</span>

<span class=cp>#endif  </span><span class=c1>// RBTREE_HPP</span>
</code></pre></div></td></tr></table></div></details><details class=note data-original-document-end=5405 data-original-document-start=5137><summary>例题：<a href=https://www.luogu.com.cn/problem/P3369 target=_blank>Luogu P3369【模板】普通平衡树</a> 与 <a href=https://www.luogu.com.cn/problem/P6136 target=_blank>Luogu P6136【模板】普通平衡树（数据加强版）</a></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>  1</span>
<span class=normal>  2</span>
<span class=normal>  3</span>
<span class=normal>  4</span>
<span class=normal>  5</span>
<span class=normal>  6</span>
<span class=normal>  7</span>
<span class=normal>  8</span>
<span class=normal>  9</span>
<span class=normal> 10</span>
<span class=normal> 11</span>
<span class=normal> 12</span>
<span class=normal> 13</span>
<span class=normal> 14</span>
<span class=normal> 15</span>
<span class=normal> 16</span>
<span class=normal> 17</span>
<span class=normal> 18</span>
<span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span></pre></div></td><td class=code><div><pre><span></span><code><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;cassert></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;cstdint></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;functional></span>

<span class=k>using</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=kt>size_t</span><span class=p>;</span>

<span class=cm>/**</span>
<span class=cm> * An RBTree-based set implementation</span>
<span class=cm> *</span>
<span class=cm> * @tparam key_t key type</span>
<span class=cm> * @tparam compare_t compare function</span>
<span class=cm> */</span>
<span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>key_t</span><span class=p>,</span><span class=w> </span><span class=k>typename</span><span class=w> </span><span class=nc>compare_t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>less</span><span class=o>&lt;</span><span class=kt>key_t</span><span class=o>>></span>
<span class=k>struct</span><span class=w> </span><span class=nc>rb_tree</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Tree node</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>struct</span><span class=w> </span><span class=nc>node_t</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=n>fa</span><span class=p>;</span><span class=w>     </span><span class=c1>// == nullptr if root of the tree, otherwise parent</span>
<span class=w>    </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=n>ch</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span><span class=w>  </span><span class=c1>// == nullptr if child is empty</span>
<span class=w>                    </span><span class=c1>// ch[0]: left child, ch[1]: right child</span>
<span class=w>    </span><span class=kt>key_t</span><span class=w> </span><span class=n>data</span><span class=p>;</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>sz</span><span class=p>;</span><span class=w>  </span><span class=c1>// Size of subtree</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>red</span><span class=p>;</span><span class=w>   </span><span class=c1>// == true if node is red, otherwise black</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * Get child direction of current non-null node</span>
<span class=cm>     *</span>
<span class=cm>     * @return true if this node is right child of its parent, otherwise false</span>
<span class=cm>     */</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>child_dir</span><span class=p>()</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>fa</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span><span class=w> </span><span class=p>}</span>
<span class=w>  </span><span class=p>};</span>

<span class=w>  </span><span class=k>using</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=p>;</span>
<span class=w>  </span><span class=k>using</span><span class=w> </span><span class=n>const_pointer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=p>;</span>
<span class=w>  </span><span class=k>using</span><span class=w> </span><span class=n>pointer_const</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node_t</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=p>;</span>

<span class=w>  </span><span class=k>const</span><span class=w> </span><span class=n>compare_t</span><span class=w> </span><span class=n>compare</span><span class=p>;</span>
<span class=w>  </span><span class=n>pointer</span><span class=w> </span><span class=n>root</span><span class=p>;</span>

<span class=w>  </span><span class=n>rb_tree</span><span class=p>()</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>compare</span><span class=p>{},</span><span class=w> </span><span class=n>root</span><span class=p>{</span><span class=k>nullptr</span><span class=p>}</span><span class=w> </span><span class=p>{}</span>


<span class=w>  </span><span class=o>~</span><span class=n>rb_tree</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>post_order</span><span class=p>([](</span><span class=k>auto</span><span class=w> </span><span class=n>it</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>delete</span><span class=w> </span><span class=n>it</span><span class=p>;</span><span class=w> </span><span class=p>});</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>size</span><span class=p>()</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>root</span><span class=p>);</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>F</span><span class=o>></span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>pre_order</span><span class=p>(</span><span class=n>F</span><span class=w> </span><span class=n>callback</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=o>&</span><span class=p>](</span><span class=k>auto</span><span class=w> </span><span class=o>&&</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span>
<span class=w>      </span><span class=n>callback</span><span class=p>(</span><span class=n>p</span><span class=p>),</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
<span class=w>    </span><span class=p>};</span>
<span class=w>    </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>root</span><span class=p>);</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>F</span><span class=o>></span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>in_order</span><span class=p>(</span><span class=n>F</span><span class=w> </span><span class=n>callback</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=o>&</span><span class=p>](</span><span class=k>auto</span><span class=w> </span><span class=o>&&</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span>
<span class=w>      </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span><span class=w> </span><span class=n>callback</span><span class=p>(</span><span class=n>p</span><span class=p>),</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
<span class=w>    </span><span class=p>};</span>
<span class=w>    </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>root</span><span class=p>);</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>F</span><span class=o>></span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>post_order</span><span class=p>(</span><span class=n>F</span><span class=w> </span><span class=n>callback</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=o>&</span><span class=p>](</span><span class=k>auto</span><span class=w> </span><span class=o>&&</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span>
<span class=w>      </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span><span class=w> </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]),</span><span class=w> </span><span class=n>callback</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
<span class=w>    </span><span class=p>};</span>
<span class=w>    </span><span class=n>f</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=w> </span><span class=n>root</span><span class=p>);</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>leftmost</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>most</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>rightmost</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>most</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>prev</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>neighbour</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>next</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>neighbour</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>lower_bound</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>const_pointer</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>,</span><span class=w> </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>compare</span><span class=p>(</span><span class=n>now</span><span class=o>-></span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>))</span>
<span class=w>        </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
<span class=w>      </span><span class=k>else</span>
<span class=w>        </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>pointer</span><span class=p>)</span><span class=n>ans</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>upper_bound</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>const_pointer</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>,</span><span class=w> </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>compare</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>data</span><span class=p>))</span>
<span class=w>        </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
<span class=w>      </span><span class=k>else</span>
<span class=w>        </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>pointer</span><span class=p>)</span><span class=n>ans</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=c1>// Order start from 0</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>order_of_key</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>compare</span><span class=p>(</span><span class=n>now</span><span class=o>-></span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>))</span>
<span class=w>        </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
<span class=w>      </span><span class=k>else</span>
<span class=w>        </span><span class=n>ans</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ans</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=c1>// Order start from 0</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>find_by_order</span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>order</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>const_pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>const_pointer</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>,</span><span class=w> </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>>=</span><span class=w> </span><span class=n>order</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>lsize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>order</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>lsize</span><span class=p>)</span>
<span class=w>        </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
<span class=w>      </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=p>;</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>order</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>lsize</span><span class=p>)</span><span class=w> </span><span class=k>break</span><span class=p>;</span>
<span class=w>        </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=n>lsize</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ans</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @return nullptr if insert failed, otherwise pointer of inserted node</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>insert</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>const_pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>pointer</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>node_t</span><span class=p>;</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=n>pointer</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=p>;</span>
<span class=w>      </span><span class=n>dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>compare</span><span class=p>(</span><span class=n>now</span><span class=o>-></span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=p>);</span>
<span class=w>      </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>];</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>insert_fixup_leaf</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>dir</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>n</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @return succeed or not</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>erase</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>key_t</span><span class=w> </span><span class=o>&</span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lower_bound</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>data</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>    </span><span class=n>erase</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @return {@code next(p)}</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>erase</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>const_pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=n>pointer</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>leftmost</span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
<span class=w>      </span><span class=n>std</span><span class=o>::</span><span class=n>swap</span><span class=p>(</span><span class=n>s</span><span class=o>-></span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>data</span><span class=p>);</span>
<span class=w>      </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span>
<span class=w>      </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>next</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
<span class=w>    </span><span class=n>erase_fixup_branch_or_leaf</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
<span class=w>    </span><span class=k>delete</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w> </span><span class=k>private</span><span class=o>:</span>
<span class=w>  </span><span class=k>static</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=k>static</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>is_red</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nb>false</span><span class=p>;</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @param dir 0: leftmost, 1: rightmost</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>most</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>])</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>];</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>pointer</span><span class=p>)</span><span class=n>p</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @param dir 0: prev, 1: next</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>neighbour</span><span class=p>(</span><span class=n>const_pointer</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>])</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>most</span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>],</span><span class=w> </span><span class=o>!</span><span class=n>dir</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>child_dir</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Insert leaf node {@code n} to {@code p}</span>
<span class=cm>   *</span>
<span class=cm>   * @param p parent of node which will be inserted</span>
<span class=cm>   * @param n leaf node which will be inserted</span>
<span class=cm>   * @param dir direction of n, 0: left; 1: right</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>insert_leaf</span><span class=p>(</span><span class=n>pointer_const</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>pointer_const</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=n>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=p>;</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>sz</span><span class=o>++</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Erase node {@code n}</span>
<span class=cm>   *</span>
<span class=cm>   * @param n node which will be deleted, must have no more than 2 child</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>erase_branch_or_leaf</span><span class=p>(</span><span class=n>pointer_const</span><span class=w> </span><span class=n>n</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=n>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>()]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>now</span><span class=p>)</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>sz</span><span class=o>--</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * @param p root of subtree (may be same as {@code root})</span>
<span class=cm>   * @param dir direction. 0: left rotate; 1: right rotate</span>
<span class=cm>   * @return new root of subtree</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>rotate</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>dir</span><span class=p>];</span><span class=w>  </span><span class=c1>// new root of subtree</span>
<span class=w>    </span><span class=n>assert</span><span class=p>(</span><span class=n>s</span><span class=p>);</span><span class=w>             </span><span class=c1>// pointer to true node required</span>
<span class=w>    </span><span class=n>s</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>sz</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>])</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>size</span><span class=p>(</span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>])</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>];</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>c</span><span class=p>)</span><span class=w> </span><span class=n>c</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>dir</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>c</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>dir</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>fa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>g</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>g</span><span class=p>)</span>
<span class=w>      </span><span class=n>g</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>p</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>g</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=k>else</span>
<span class=w>      </span><span class=n>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>s</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=cp>#pragma GCC diagnostic ignored "-Wcomment"</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Insert leaf node {@code n} to {@code p}, then fixup</span>
<span class=cm>   *</span>
<span class=cm>   * @param p parent of node which will be inserted</span>
<span class=cm>   * @param n node which will be inserted</span>
<span class=cm>   * @param dir direction of n, 0: left; 1: right</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>insert_fixup_leaf</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>pointer</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>dir</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>    </span><span class=n>insert_leaf</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>dir</span><span class=p>);</span>
<span class=w>    </span><span class=c1>// Fix double red</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>is_red</span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=kt>bool</span><span class=w> </span><span class=n>p_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>child_dir</span><span class=p>();</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>fa</span><span class=p>,</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>g</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>p_dir</span><span class=p>];</span>
<span class=w>      </span><span class=c1>// Case 1: both p and u are red</span>
<span class=w>      </span><span class=c1>//      g              [g]</span>
<span class=w>      </span><span class=c1>//     / \             / \</span>
<span class=c1>      //   [p] [u]   ==>    p   u</span>
<span class=w>      </span><span class=c1>//   /               /</span>
<span class=w>      </span><span class=c1>// [n]             [n]</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>is_red</span><span class=p>(</span><span class=n>u</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>u</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>        </span><span class=n>g</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>g</span><span class=p>;</span>
<span class=w>        </span><span class=k>continue</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=c1>// p is red and u is black</span>
<span class=w>      </span><span class=c1>// Case 2: dir of n is different with dir of p</span>
<span class=w>      </span><span class=c1>//    g              g</span>
<span class=w>      </span><span class=c1>//   / \            / \</span>
<span class=c1>      // [p]  u   ==>   [n]  u</span>
<span class=w>      </span><span class=c1>//   \            /</span>
<span class=w>      </span><span class=c1>//   [n]        [p]</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>p_dir</span><span class=p>)</span><span class=w> </span><span class=n>rotate</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>p_dir</span><span class=p>),</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>swap</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=p>);</span>
<span class=w>      </span><span class=c1>// Case 3: p is red, u is black and dir of n is same as dir of p</span>
<span class=w>      </span><span class=c1>//      g             p</span>
<span class=w>      </span><span class=c1>//     / \           / \</span>
<span class=c1>      //   [p]  u   ==>  [n] [g]</span>
<span class=w>      </span><span class=c1>//   /                   \</span>
<span class=c1>      // [n]                    u</span>
<span class=w>      </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span><span class=w> </span><span class=n>g</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>      </span><span class=n>rotate</span><span class=p>(</span><span class=n>g</span><span class=p>,</span><span class=w> </span><span class=o>!</span><span class=n>p_dir</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=c1>// Post process: color root black</span>
<span class=w>    </span><span class=n>root</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=cm>/**</span>
<span class=cm>   * Erase node {@code n}, then fixup</span>
<span class=cm>   *</span>
<span class=cm>   * @param n node which will be deleted, must have no more than 2 child</span>
<span class=cm>   */</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>erase_fixup_branch_or_leaf</span><span class=p>(</span><span class=n>pointer</span><span class=w> </span><span class=n>n</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>n_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>root</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nb>false</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>();</span>
<span class=w>    </span><span class=n>erase_branch_or_leaf</span><span class=p>(</span><span class=n>n</span><span class=p>);</span>
<span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// n is root</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=n>root</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// n has 1 child</span>
<span class=w>        </span><span class=c1>// n must be black and s must be red, so we need to color s black</span>
<span class=w>        </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>        </span><span class=k>return</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=c1>// n is not root but leaf with black color, need to be fixup</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=o>!</span><span class=n>n</span><span class=o>-></span><span class=n>red</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=c1>// Case 1: s is red</span>
<span class=w>      </span><span class=c1>//    p               s</span>
<span class=w>      </span><span class=c1>//   / \             / \</span>
<span class=c1>      // |n| [s]   ==>   [p]  d</span>
<span class=w>      </span><span class=c1>//     / \         / \</span>
<span class=c1>      //    c   d      |n|  c</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>is_red</span><span class=p>(</span><span class=n>s</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>rotate</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n_dir</span><span class=p>);</span>
<span class=w>        </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=c1>// s must be black</span>
<span class=w>      </span><span class=k>auto</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n_dir</span><span class=p>],</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=c1>// Case 2: both c and d are black</span>
<span class=w>      </span><span class=c1>//   {p}          {p}</span>
<span class=w>      </span><span class=c1>//   / \          / \</span>
<span class=c1>      // |n|  s   ==> |n| [s]</span>
<span class=w>      </span><span class=c1>//     / \          / \</span>
<span class=c1>      //    c   d        c   d</span>
<span class=w>      </span><span class=c1>// p will be colored black in the end</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>is_red</span><span class=p>(</span><span class=n>c</span><span class=p>)</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=o>!</span><span class=n>is_red</span><span class=p>(</span><span class=n>d</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
<span class=w>        </span><span class=k>goto</span><span class=w> </span><span class=n>end_erase_fixup</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=c1>// Case 3: c is red and d is black</span>
<span class=w>      </span><span class=c1>//   {p}          {p}</span>
<span class=w>      </span><span class=c1>//   / \          / \</span>
<span class=c1>      // |n|  s   ==> |n|  c</span>
<span class=w>      </span><span class=c1>//     / \            \</span>
<span class=c1>      //   [c]  d           [s]</span>
<span class=w>      </span><span class=c1>//                      \</span>
<span class=c1>      //                       d</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>is_red</span><span class=p>(</span><span class=n>d</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>c</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<span class=w>        </span><span class=n>rotate</span><span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=o>!</span><span class=n>n_dir</span><span class=p>);</span>
<span class=w>        </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>],</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=n>n_dir</span><span class=p>],</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=o>-></span><span class=n>ch</span><span class=p>[</span><span class=o>!</span><span class=n>n_dir</span><span class=p>];</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=c1>// Case 4: d is red</span>
<span class=w>      </span><span class=c1>//   {p}            {s}</span>
<span class=w>      </span><span class=c1>//   / \            / \</span>
<span class=c1>      // |n|  s   ==>    p   d</span>
<span class=w>      </span><span class=c1>//     / \        / \</span>
<span class=c1>      //   {c} [d]    |n| {c}</span>
<span class=w>      </span><span class=n>s</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>      </span><span class=n>rotate</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>n_dir</span><span class=p>),</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span>
<span class=w>    </span><span class=nl>end_erase_fixup</span><span class=p>:</span>
<span class=w>      </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>fa</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span><span class=w> </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=n>n_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=o>-></span><span class=n>child_dir</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=c1>// Post process: see case 2 & case 4</span>
<span class=w>    </span><span class=n>n</span><span class=o>-></span><span class=n>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=p>};</span>

<span class=cp>#pragma GCC diagnostic warning "-Wcomment"</span>

<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;iostream></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;numeric></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;vector></span>

<span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=kt>bool</span><span class=w> </span><span class=n>P6136</span><span class=o>></span><span class=w>  </span><span class=c1>// == false: P3369, == true: P6136</span>
<span class=k>struct</span><span class=w> </span><span class=nc>IO_luogu_P3369_P6136</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>last_ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>  </span><span class=n>std</span><span class=o>::</span><span class=kt>size_t</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>m</span><span class=p>;</span>
<span class=w>  </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>></span><span class=w> </span><span class=n>a</span><span class=p>;</span>
<span class=w>  </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>></span><span class=w> </span><span class=n>ans_list</span><span class=p>;</span>

<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=nf>init</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>cin</span><span class=w> </span><span class=o>>></span><span class=w> </span><span class=n>n</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>P6136</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=p>;</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>cin</span><span class=w> </span><span class=o>>></span><span class=w> </span><span class=n>m</span><span class=p>;</span>
<span class=w>    </span><span class=n>a</span><span class=p>.</span><span class=n>resize</span><span class=p>(</span><span class=n>n</span><span class=p>);</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=o>&</span><span class=n>i</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>cin</span><span class=w> </span><span class=o>>></span><span class=w> </span><span class=n>i</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=nf>opt</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>;</span>
<span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>cin</span><span class=w> </span><span class=o>>></span><span class=w> </span><span class=n>x</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>x</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=nf>x</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>;</span>
<span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>cin</span><span class=w> </span><span class=o>>></span><span class=w> </span><span class=n>x</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>P6136</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>^</span><span class=w> </span><span class=n>last_ans</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=nf>print</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>ans</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>ans_list</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>last_ans</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ans</span><span class=p>);</span><span class=w> </span><span class=p>}</span>

<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=nf>print_total_ans</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>P6136</span><span class=p>)</span>
<span class=w>      </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>accumulate</span><span class=p>(</span><span class=n>ans_list</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=w> </span><span class=n>ans_list</span><span class=p>.</span><span class=n>end</span><span class=p>(),</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
<span class=w>                                   </span><span class=n>std</span><span class=o>::</span><span class=n>bit_xor</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>></span><span class=p>{})</span>
<span class=w>                </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=sc>'\n'</span><span class=p>;</span>
<span class=w>    </span><span class=k>else</span>
<span class=w>      </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=o>&&</span><span class=n>i</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>ans_list</span><span class=p>)</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=sc>'\n'</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
<span class=p>};</span>

<span class=c1>// 把这里的模板参数改为 false 即为「Luogu P3369【模板】普通平衡树」的代码</span>
<span class=n>IO_luogu_P3369_P6136</span><span class=o>&lt;</span><span class=nb>true</span><span class=o>></span><span class=w> </span><span class=n>io</span><span class=p>;</span>

<span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>std</span><span class=o>::</span><span class=n>cin</span><span class=p>.</span><span class=n>tie</span><span class=p>(</span><span class=k>nullptr</span><span class=p>)</span><span class=o>-></span><span class=n>sync_with_stdio</span><span class=p>(</span><span class=nb>false</span><span class=p>);</span>
<span class=w>  </span><span class=n>io</span><span class=p>.</span><span class=n>init</span><span class=p>();</span>
<span class=w>  </span><span class=n>std</span><span class=o>::</span><span class=kt>size_t</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>io</span><span class=p>.</span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>io</span><span class=p>.</span><span class=n>m</span><span class=p>;</span>
<span class=w>  </span><span class=n>rb_tree</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=o>>></span><span class=w> </span><span class=n>bt</span><span class=p>;</span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>cnt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>io</span><span class=p>.</span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=n>bt</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>make_pair</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>cnt</span><span class=o>++</span><span class=p>));</span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>opt</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w> </span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=kt>size_t</span><span class=p>)</span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>m</span><span class=p>;</span><span class=w> </span><span class=o>++</span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>opt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>io</span><span class=p>.</span><span class=n>opt</span><span class=p>(),</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>io</span><span class=p>.</span><span class=n>x</span><span class=p>();</span>
<span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>opt</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>case</span><span class=w> </span><span class=mi>1</span><span class=p>:</span>
<span class=w>        </span><span class=n>bt</span><span class=p>.</span><span class=n>insert</span><span class=p>({</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>cnt</span><span class=o>++</span><span class=p>});</span>
<span class=w>        </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=k>case</span><span class=w> </span><span class=mi>2</span><span class=p>:</span>
<span class=w>        </span><span class=n>bt</span><span class=p>.</span><span class=n>erase</span><span class=p>(</span><span class=n>bt</span><span class=p>.</span><span class=n>lower_bound</span><span class=p>({</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>}));</span>
<span class=w>        </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=k>case</span><span class=w> </span><span class=mi>3</span><span class=p>:</span>
<span class=w>        </span><span class=n>io</span><span class=p>.</span><span class=n>print</span><span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=n>bt</span><span class=p>.</span><span class=n>order_of_key</span><span class=p>({</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>})</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
<span class=w>        </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=k>case</span><span class=w> </span><span class=mi>4</span><span class=p>:</span>
<span class=w>        </span><span class=n>io</span><span class=p>.</span><span class=n>print</span><span class=p>(</span><span class=n>bt</span><span class=p>.</span><span class=n>find_by_order</span><span class=p>((</span><span class=kt>uint32_t</span><span class=p>)</span><span class=n>x</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=o>-></span><span class=n>data</span><span class=p>.</span><span class=n>first</span><span class=p>);</span>
<span class=w>        </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=k>case</span><span class=w> </span><span class=mi>6</span><span class=p>:</span>
<span class=w>        </span><span class=n>io</span><span class=p>.</span><span class=n>print</span><span class=p>(</span><span class=n>bt</span><span class=p>.</span><span class=n>upper_bound</span><span class=p>({</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>m</span><span class=p>})</span><span class=o>-></span><span class=n>data</span><span class=p>.</span><span class=n>first</span><span class=p>);</span>
<span class=w>        </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=k>case</span><span class=w> </span><span class=mi>5</span><span class=p>:</span>
<span class=w>        </span><span class=k>auto</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bt</span><span class=p>.</span><span class=n>lower_bound</span><span class=p>({</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>});</span>
<span class=w>        </span><span class=n>io</span><span class=p>.</span><span class=n>print</span><span class=p>((</span><span class=n>it</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>bt</span><span class=p>.</span><span class=n>prev</span><span class=p>(</span><span class=n>it</span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>bt</span><span class=p>.</span><span class=n>rightmost</span><span class=p>(</span><span class=n>bt</span><span class=p>.</span><span class=n>root</span><span class=p>))</span><span class=o>-></span><span class=n>data</span><span class=p>.</span><span class=n>first</span><span class=p>);</span>
<span class=w>        </span><span class=k>break</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=n>io</span><span class=p>.</span><span class=n>print_total_ans</span><span class=p>();</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div></details><h2 data-original-document-end=5422 data-original-document-start=5407 id=与-2-3-4-树的关系>与 2-3-4 树的关系<a title="Permanent link" class=headerlink href=#与-2-3-4-树的关系></a></h2><p data-original-document-end=5571 data-original-document-start=5424>2-3-4 树是 4 阶 B 树，与一般的 B 树一样，2-3-4 树可以实现在 <mjx-container class=MathJax jax=CHTML overflow=scroll style=position:relative><mjx-math data-latex="O(\log n)" aria-hidden=true class=NCM-N><mjx-mi data-latex=O><mjx-c class=mjx-c1D442>𝑂</mjx-c></mjx-mi><mjx-mo data-latex=(><mjx-c class=mjx-c28>(</mjx-c></mjx-mo><mjx-mi data-latex=\log><mjx-c class=mjx-c6C noic=true style=padding-top:.694em>l</mjx-c><mjx-c class=mjx-c6F noic=true style=padding-top:.694em>o</mjx-c><mjx-c class=mjx-c67 style=padding-top:.694em>g</mjx-c></mjx-mi><mjx-mo><mjx-c class=mjx-c2061>⁡</mjx-c></mjx-mo><mjx-mi data-latex=n space=2><mjx-c class=mjx-c1D45B>𝑛</mjx-c></mjx-mi><mjx-mo data-latex=)><mjx-c class=mjx-c29>)</mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math data-latex="O(\log n)" xmlns=http://www.w3.org/1998/Math/MathML><mi data-latex=O>O</mi><mo data-latex=( stretchy=false>(</mo><mi data-latex=\log>log</mi><mo data-mjx-texclass=NONE>⁡</mo><mi data-latex=n>n</mi><mo data-latex=) stretchy=false>)</mo></math></mjx-assistive-mml><img title="O(\log n)" src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7></mjx-container> 时间内进行搜索、插入和删除操作．2-3-4 树的节点分为三种，2 节点、3 节点和 4 节点，分别包含一个、两个或三个数据元素．所有的叶子节点都处于同一深度（最底层），所有数据都有序存储．</p><p data-original-document-end=5754 data-original-document-start=5573>2-3-4 树和红黑树是同构的，任意一棵红黑树都唯一对应一棵 2-3-4 树．在 2-3-4 树上的插入和删除操作导致节点的扩展、分裂和合并，相当于红黑树中的变色和旋转．下图是 2-3-4 树的 2 节点、3 节点和 4 节点对应的红黑树节点．注意到 2-3-4 树的 3 节点对应红黑树中红色节点左偏和右偏两种情况，所以一棵红黑树可能对应多棵 2-3-4 树．</p><p data-original-document-end=5804 data-original-document-start=5756><img alt=2-3-4-tree-rbt-1 src=../images/2-3-4-tree-rbt-1.svg></p><p data-original-document-end=5909 data-original-document-start=5806>下图是一棵红黑树和与之对应的 2-3-4 树．将红黑树中的红色节点上移到父节点的左右两侧，形成一个 B 树节点，就可以得到与之对应的 2-3-4 树．可以发现，红黑树的节点数等于 2-3-4 树的节点个数．</p><p data-original-document-end=5957 data-original-document-start=5911><img alt=2-3-4-tree-rbt src=../images/2-3-4-tree-rbt-2.svg></p><p data-original-document-end=6001 data-original-document-start=5959>可以通过对比 2-3-4 树来理解红黑树的插入和删除操作．<sup id=fnref:234-vs-rbt><a class=footnote-ref href=#fn:234-vs-rbt>2</a></sup></p><h2 data-original-document-end=6016 data-original-document-start=6003 id=实际工程项目中的使用>实际工程项目中的使用<a title="Permanent link" class=headerlink href=#实际工程项目中的使用></a></h2><p data-original-document-end=6098 data-original-document-start=6018>由于红黑树是目前主流工业界综合效率最高的内存型平衡树，其在实际的工程项目中有着广泛的使用，这里列举几个实际的使用案例并给出相应的源码链接，以便读者进行对比学习．</p><h3 data-original-document-end=6109 data-original-document-start=6100 id=linux>Linux<a title="Permanent link" class=headerlink href=#linux></a></h3><p data-original-document-end=6114 data-original-document-start=6111>源码：</p><ul data-original-document-end=6203 data-original-document-start=6116><li><a href=https://elixir.bootlin.com/linux/latest/source/lib/rbtree.c target=_blank><code>linux/lib/rbtree.c</code></a></li></ul><p data-original-document-end=6300 data-original-document-start=6205>Linux 中的红黑树所有操作均使用循环迭代进行实现，保证效率的同时又增加了大量的注释来保证代码可读性，十分建议读者阅读学习．Linux 内核中的红黑树使用非常广泛，这里仅列举几个经典案例．</p><ul data-original-document-end=6786 data-original-document-start=6302><li><p><a href=https://www.kernel.org/doc/html/latest/scheduler/sched-design-CFS.html target=_blank>CFS 非实时任务调度</a></p> <p>Linux 的稳定内核版本在 2.6.24 之后，使用了新的调度程序 CFS，所有非实时可运行进程都以虚拟运行时间为键值用一棵红黑树进行维护，以完成更公平高效地调度所有任务．CFS 弃用 active/expired 数组和动态计算优先级，不再跟踪任务的睡眠时间和区别是否交互任务，而是在调度中采用基于时间计算键值的红黑树来选取下一个任务，根据所有任务占用 CPU 时间的状态来确定调度任务优先级．</p></li><li><p><a href=https://man7.org/linux/man-pages/man7/epoll.7.html target=_blank>epoll</a></p> <p>epoll 全称 event poll，是 Linux 内核实现 IO 多路复用 (IO multiplexing) 的一个实现，是原先 poll/select 的改进版．Linux 中 epoll 的实现选择使用红黑树来储存文件描述符．</p></li></ul><h3 data-original-document-end=6797 data-original-document-start=6788 id=nginx>Nginx<a title="Permanent link" class=headerlink href=#nginx></a></h3><p>源码：</p><ul data-original-document-end=7007 data-original-document-start=6804><li><a href=https://github.com/nginx/nginx/blob/master/src/core/ngx_rbtree.h target=_blank><code>nginx/src/core/ngx_rbtree.h</code></a></li><li><a href=https://github.com/nginx/nginx/blob/master/src/core/ngx_rbtree.c target=_blank><code>nginx/src/core/ngx_rbtree.c</code></a></li></ul><p data-original-document-end=7229 data-original-document-start=7009>nginx 中的用户态定时器是通过红黑树实现的．在 nginx 中，所有 timer 节点都由一棵红黑树进行维护，在 worker 进程的每一次循环中都会调用 <code>ngx_process_events_and_timers</code> 函数，在该函数中就会调用处理定时器的函数 <code>ngx_event_expire_timers</code>，每次该函数都不断的从红黑树中取出时间值最小的，查看他们是否已经超时，然后执行他们的函数，直到取出的节点的时间没有超时为止．</p><p data-original-document-end=7267 data-original-document-start=7231>关于 nginx 中红黑树的源码分析公开资源很多，读者可以自行查找学习．</p><h3 data-original-document-end=7276 data-original-document-start=7269 id=c>C++<a title="Permanent link" class=headerlink href=#c></a></h3><p>源码：</p><ul data-original-document-end=8082 data-original-document-start=7283><li><p>GNU libstdc++</p> <ul><li><a href=https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/bits/stl_tree.h target=_blank><code>libstdc++-v3/include/bits/stl_tree.h</code></a></li><li><a href=https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/src/c%2B%2B98/tree.cc target=_blank><code>libstdc++-v3/src/c++98/tree.cc</code></a></li></ul> <p>另外，<code>libstdc++</code> 在 <code>&lt;ext/rb_tree></code> 中提供了 <a href=https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/ext/rb_tree target=_blank><code>__gnu_cxx::rb_tree</code></a>，其继承了 <code>std::_Rb_tree</code>，可以认为是供外部使用的类型别名．需要注意的是，该头文件 <strong>不是</strong> C++ 标准的一部分，所以非必要不推荐使用．</p> <p><code>libstdc++</code> 的 <a href=../../lang/pb-ds/tree/><code>pb_ds</code></a> 中也提供了红黑树．</p></li><li><p>LLVM libcxx</p> <ul><li><a href=https://github.com/llvm/llvm-project/blob/main/libcxx/include/__tree target=_blank><code>libcxx/include/__tree</code></a></li></ul></li><li><p>Microsoft STL</p> <ul><li><a href=https://github.com/microsoft/STL/blob/main/stl/inc/xtree target=_blank><code>stl/inc/xtree</code></a></li></ul></li></ul><p data-original-document-end=8243 data-original-document-start=8084>大多数 STL 中的 <code>std::set</code> 和 <code>std::map</code> 的内部数据结构就是红黑树（例如上面提到的这些）．不过值得注意的是，C++ 标准并未规定必须以红黑树实现 <code>std::set</code> 和 <code>std::map</code>，所以不应该在工程项目中直接使用 <code>std::set</code> 和 <code>std::map</code> 的内部数据结构．</p><h3 data-original-document-end=8256 data-original-document-start=8245 id=openjdk>OpenJDK<a title="Permanent link" class=headerlink href=#openjdk></a></h3><p>源码：</p><ul data-original-document-end=8643 data-original-document-start=8263><li><a href=https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/TreeMap.java target=_blank><code>java.util.TreeMap&lt;K, V></code></a></li><li><a href=https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/TreeSet.java target=_blank><code>java.util.TreeSet&lt;K, V></code></a></li><li><a href=https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashMap.java target=_blank><code>java.util.HashMap&lt;K, V></code></a></li></ul><p data-original-document-end=8755 data-original-document-start=8645>JDK 中的 <code>TreeMap</code> 和 <code>TreeSet</code> 都是使用红黑树作为底层数据结构的．同时在 JDK 1.8 之后 <code>HashMap</code> 内部哈希表中每个表项的链表长度超过 8 时也会自动转变为红黑树以提升查找效率．</p><h2 data-original-document-end=8764 data-original-document-start=8757 id=参考资料>参考资料<a title="Permanent link" class=headerlink href=#参考资料></a></h2><ul data-original-document-end=9715 data-original-document-start=8766><li>Cormen, T. H., Leiserson, C. E., Rivest, R. L., & Stein, C. (2022).<em>Introduction to algorithms</em>. MIT press.</li><li><a href=https://en.wikipedia.org/wiki/Red%E2%80%93black_tree target=_blank>Red-Black Tree - Wikipedia</a></li><li><a href=https://www.cs.usfca.edu/~galles/visualization/RedBlack.html target=_blank>Red-Black Tree Visualization</a></li></ul><div class=footnote><hr><ol><li id=fn:gilbas1978><p>L. J. Guibas and R. Sedgewick, "A dichromatic framework for balanced trees,"<em>19<sup>th</sup> Annual Symposium on Foundations of Computer Science (sfcs 1978)</em>, Ann Arbor, MI, USA, 1978, pp. 8-21, doi:<a href=https://doi.org/10.1109%2FSFCS.1978.3 target=_blank>10.1109/SFCS.1978.3</a>. <a title="Jump back to footnote 1 in the text" class=footnote-backref href=#fnref:gilbas1978>↩</a></p></li><li id=fn:234-vs-rbt><p><a href=https://www.cnblogs.com/zhenbianshu/p/8185345.html target=_blank>这篇博文</a> 提供了详细的描述． <a title="Jump back to footnote 2 in the text" class=footnote-backref href=#fnref:234-vs-rbt>↩</a></p></li><li id=fn:cite_note-cormen2009-18><p><a href=https://en.wikipedia.org/wiki/Red–black_tree#cite_note-Cormen2009-18 target=_blank>https://en.wikipedia.org/wiki/Red–black_tree#cite_note-Cormen2009-18</a> <a title="Jump back to footnote 3 in the text" class=footnote-backref href=#fnref:cite_note-cormen2009-18>↩</a></p></li><li id=fn:cite_note-mehlhorn2008-17><p><a href=https://en.wikipedia.org/wiki/Red–black_tree#cite_note-Mehlhorn2008-17 target=_blank>https://en.wikipedia.org/wiki/Red–black_tree#cite_note-Mehlhorn2008-17</a> <a title="Jump back to footnote 4 in the text" class=footnote-backref href=#fnref:cite_note-mehlhorn2008-17>↩</a></p></li><li id=fn:cite_note-algs4-16><p><a href=https://en.wikipedia.org/wiki/Red–black_tree#cite_note-Algs4-16 target=_blank>https://en.wikipedia.org/wiki/Red–black_tree#cite_note-Algs4-16</a>: 432–447 <a title="Jump back to footnote 5 in the text" class=footnote-backref href=#fnref:cite_note-algs4-16>↩</a></p></li></ol></div><hr><blockquote class=page-copyright><span><i class=md-icon><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m22.7 19-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4"></path></svg></i>本页面最近更新：</span><span class=facts_modified>2026/1/7 08:56:54</span>，<a class=edit_history href=https://github.com/OI-wiki/OI-wiki/commits/master/docs/ds/rbtree.md target=_blank>更新历史</a><br><span><i class=md-icon><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"></path></svg></i>发现错误？想一起完善？ <a href="https://oi-wiki.org/edit-landing/?ref=/ds/rbtree.md" class=page_edit_url title=edit.link.title>在 GitHub 上编辑此页！</a></span><br><span><i class=md-icon><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M16 17v2H2v-2s0-4 7-4 7 4 7 4m-3.5-9.5A3.5 3.5 0 1 0 9 11a3.5 3.5 0 0 0 3.5-3.5m3.44 5.5A5.32 5.32 0 0 1 18 17v2h4v-2s0-3.63-6.06-4M15 4a3.4 3.4 0 0 0-1.93.59 5 5 0 0 1 0 5.82A3.4 3.4 0 0 0 15 11a3.5 3.5 0 0 0 0-7"></path></svg></i>本页面贡献者：</span><span class=page_contributors><a href=https://github.com/Tiphereth-A target=_blank>Tiphereth-A</a>, <a href=https://github.com/trudbot target=_blank>trudbot</a>, <a href=https://github.com/yuhuoji target=_blank>yuhuoji</a>, <a href=https://github.com/0x03A6 target=_blank>0x03A6</a>, <a href=https://github.com/abc1763613206 target=_blank>abc1763613206</a>, <a href=https://github.com/auuuu4 target=_blank>auuuu4</a>, <a href=https://github.com/c-forrest target=_blank>c-forrest</a>, <a href=https://github.com/CCXXXI target=_blank>CCXXXI</a>, <a href=https://github.com/Conless target=_blank>Conless</a>, <a href=https://github.com/Enter-tainer target=_blank>Enter-tainer</a>, <a href=https://github.com/fanenr target=_blank>fanenr</a>, <a href=https://github.com/hsfzLZH1 target=_blank>hsfzLZH1</a>, <a href=https://github.com/iamtwz target=_blank>iamtwz</a>, <a href=https://github.com/leverimmy target=_blank>leverimmy</a>, <a href=https://github.com/Lhcfl target=_blank>Lhcfl</a>, <a href=https://github.com/Marcythm target=_blank>Marcythm</a>, <a href=https://github.com/RIvance target=_blank>RIvance</a>, <a href=https://github.com/Xeniume target=_blank>Xeniume</a>, <a href=https://github.com/Xeonacid target=_blank>Xeonacid</a>, <a href=https://github.com/aqhan target=_blank>aqhan</a>, <a href=https://github.com/Astricaelus target=_blank>Astricaelus</a>, <a href=https://github.com/happyZYM target=_blank>happyZYM</a>, <a href=https://github.com/HeRaNO target=_blank>HeRaNO</a>, <a href=https://github.com/LeverImmy target=_blank>LeverImmy</a>, <a href=https://github.com/YBYCS target=_blank>YBYCS</a></span><br><span><i class=md-icon><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M10.08 10.86c.05-.33.16-.62.3-.86.3-.56.81-.85 1.5-.86.45 0 .86.2 1.15.49.28.31.47.74.47 1.17h1.8c-.02-.47-.11-.9-.3-1.3-.15-.38-.38-.72-.68-1-1.45-1.34-4.14-1.15-5.37.37-1.29 1.67-1.32 4.59-.01 6.26 1.21 1.49 3.86 1.7 5.3.37.31-.25.56-.56.76-.92.16-.36.27-.74.28-1.15H13.5c0 .21-.07.4-.16.57-.09.19-.21.34-.34.47-.33.26-.72.4-1.14.4-.36-.01-.66-.08-.89-.23a1.4 1.4 0 0 1-.59-.64c-.5-.9-.42-2.15-.3-3.14M12 2C6.5 2 2 6.5 2 12c.53 13.27 19.5 13.26 20 0 0-5.5-4.5-10-10-10m0 18c-4.41 0-8-3.59-8-8 .44-10.61 15.56-10.61 16 0 0 4.41-3.59 8-8 8"></path></svg></i>本页面的全部内容在 <strong><a href=https://creativecommons.org/licenses/by-sa/4.0/deed.zh target=_blank>CC BY-SA 4.0</a> 和 <a href=https://github.com/zTrix/sata-license target=_blank>SATA</a></strong> 协议之条款下提供，附加条款亦可能应用</span></blockquote><div class=giscus data-no-instant id=__comments></div><div id=__comments_script></div><script>var comments=document.createElement("script"),commentsTheme="slate"===document.body.dataset.mdColorScheme?"dark":"light";Object.entries({async:!0,src:"https://giscus.app/client.js",crossOrigin:"anonymous","data-repo":"OI-wiki/gitment","data-repo-id":"MDEwOlJlcG9zaXRvcnkxNDQzODg5NjU=","data-category":"评论","data-category-id":"DIC_kwDOCJszZc4CS54y","data-mapping":"specific","data-term":"红黑树","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":commentsTheme,"data-lang":"zh-CN","data-loading":"lazy"}).forEach((e=>comments.setAttribute(e[0],e[1]))),document.getElementById("__comments_script").replaceWith(comments)</script></article></div><script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script></div></main><script>function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?document.getElementById("myBtn").style.display="block":document.getElementById("myBtn").style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}window.onscroll=function(){scrollFunction()}</script><button class=data-tip-left data-tip=回到顶部 id=myBtn onclick=topFunction()><svg class="Zi Zi--BackToTop data-tip-left" viewbox="0 0 24 24" data-tip=回到顶部 fill=currentColor height=24 width=24><path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z"></path></svg></button><footer class=md-footer><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright><div class=md-copyright__highlight>Copyright © 2016 - 2026 OI Wiki Team</div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs <div id=miitbeian></div> </a></div><div class=build_date_utc style=float:right><a href=https://github.com/OI-wiki/OI-wiki target=_blank> 最近更新：1b96d637c, 2026-02-25 </a></div><script>"oi-wiki.com"!=window.location.hostname&&"www.oi-wiki.com"!=window.location.hostname||(document.getElementById("miitbeian").innerHTML='<a href="http://beian.miit.gov.cn/">黑ICP备19005132号-2</a>'),console.log("%c OI Wiki %c 1b96d637c %c","background:#35495e ; padding: 1px; border-radius: 3px 0 0 3px;  color: #fff","background:#41b883 ; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff","background:transparent"),console.log("少年，恭喜你囍提彩蛋，我们在做一些 OI 相关的有趣的事情，如果您对此感兴趣，欢迎访问 https://join-us.oi-wiki.org")</script></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><script id=__config type=application/json>{"base": "../..", "features": ["content.action.edit", "navigation.tabs", "navigation.instant", "content.code.copy"], "search": "../../assets/javascripts/workers/search.931a43a5.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script><script src=../../assets/javascripts/bundle.73202423.min.js></script><script src="../../assets/javascripts/oiwiki-feedback-sys-frontend.js?v=5b99436423505efd4a4e01c1b294beee"></script><script src="../../_static/js/oiwiki-feedback-sys-frontend.js?v=9c84250724ffe2e409ef6df0cac8900b"></script><script>"use strict";"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then((function(e){console.log("PWA Registration succeeded. Scope is "+e.scope)})).catch((function(e){console.log("PWA Registration failed with "+e)}))</script></body></html>