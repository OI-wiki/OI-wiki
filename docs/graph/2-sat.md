author: chu-yuehan, hhc0001

SAT 是适定性（Satisfiability）问题的简称。

## 定义

2-SAT，简单的说就是给出 $n$ 个布尔方程，每个方程和两个变量相关，如 $a \vee b$，表示变量 $a, b$ 至少满足一个。然后判断是否存在可行方案，显然可能有多种选择方案，一般题中只需要求出一种即可。另外，$\neg a$ 表示 $a$ 取反。

## 解决思路

???+ example "[洛谷 P4782「模板」2-SAT](https://www.luogu.com.cn/problem/P4782)"
    有 $n$ 个布尔变量 $x_1\sim x_n$，另有 $m$ 个需要满足的条件，每个条件的形式都是「$x_i$ 为 `true`/`false` 或 $x_j$ 为 `true`/`false`」。比如「$x_1$ 为真或 $x_3$ 为假」、「$x_7$ 为假或 $x_2$ 为假」。
    
    2-SAT 问题的目标是给每个变量赋值使得所有条件得到满足。

使用布尔方程表示上述问题。设 $a$ 表示 $x_a$ 为真（$\neg a$ 就表示 $x_a$ 为假）。如果有个人提出的要求分别是 $a$ 和 $b$，即 $(a \vee b)$（变量 $a, b$ 至少满足一个）。对这些变量关系建有向图，则把 $a$ 成立或不成立用图中的点表示。

考虑或运算的定义：$\neg a\to b$ 并且 $\neg b\to a$，所以我们可以在图上建出同前的边，代表了这个约束的逻辑关系。

建图之后，我们就可以使用缩点算法来求解 2-SAT 问题了。绝大部分 2-SAT 问题都需要找出如 $a$  **不成立**，则 $b$  **成立** 的关系。

考虑两点在同一强连通分量里会发生什么。根据前文边的逻辑意义可知：若两点在同一强连通分量内，则这两点代表的条件 **要么都满足，要么都不满足**。所以，如果 $a$ 与 $\neg a$ 被缩进了同一个 SCC 里面，那么显然是无解的。使用 [Tarjan 算法找 SCC](./scc.md) 判断即可。

输出方案时可以通过变量在图中的拓扑序确定该变量的取值。如果变量 $x$ 的拓扑序在 $\neg x$ 之后，那么取 $x$ 值为真时不会有满足 $\neg x$ 的必要，所以直接使 $x$ 为真即可。应用到 Tarjan 算法的缩点，即 $x$ 所在 SCC 编号在 $\neg x$ 之前时，取 $x$ 为真。因为 Tarjan 算法求强连通分量时使用了栈，如果跑完 Tarjan 缩点之后呈现出的拓扑序更大，在 Tarjan 会更晚被遍历到，就会更早地被弹出栈而缩点，分量编号会更小，所以 Tarjan 求得的 SCC 编号相当于 **反拓扑序**。

算法会把整张图遍历一遍，由于这张图 $n$ 和 $m$ 同阶，计算答案时复杂度为 $O(n)$，因此总复杂度为 $O(n)$。

??? note "代码实现"
    ```cpp
    --8<-- "docs/graph/code/2-sat/2-sat_3.cpp"
    ```

## 例题

### 例题 1

???+ example "[HDU3062 Party](https://acm.hdu.edu.cn/showproblem.php?pid=3062)"
    有 $n$ 对夫妻被邀请参加一个聚会，因为场地的问题，每对夫妻中只有一人可以列席。在 $2n$ 个人中，某些人之间有着很大的矛盾（当然夫妻之间是没有矛盾的），有矛盾的两个人是不会同时出现在聚会上的。有没有可能会有 $n$ 个人同时列席？

按照上面的分析，如果 $a_1$ 中的丈夫和 $a_2$ 中的妻子不合，那么必须满足「$a_1$ 来妻子」或者「$a_2$ 来丈夫」，我们就把 $a_1$ 中的丈夫和 $a_2$ 中的丈夫连边，把 $a_2$ 中的妻子和 $a_1$ 中的妻子连边，其他的情况同理。然后缩点染色判断即可。

??? note "参考代码"
    ```cpp
    --8<-- "docs/graph/code/2-sat/2-sat_1.cpp"
    ```

### 例题 2

???+ example "[2018-2019 ACM-ICPC Asia Seoul Regional K TV Show Game](https://codeforces.com/gym/101987/problem/K)"
    有 $k$ 盏灯，每盏灯是红色或者蓝色，但是初始的时候不知道灯的颜色。有 $n$ 个人，每个人选择三盏灯并猜灯的颜色。一个人猜对两盏灯或以上的颜色就可以获得奖品。判断是否存在一个灯的着色方案使得每个人都能领奖，若有则输出一种灯的着色方案。

考虑对于某一个人，如果这个人的某一盏灯猜错了，那么另外两盏灯必须猜对。所以就可以建边然后 2-SAT 输出方案了。

??? note "参考代码"
    ```cpp
    --8<-- "docs/graph/code/2-sat/2-sat_2.cpp"
    ```

## C-SAT，CNF-SAT

如果把那个 2-SAT 的 2 去掉，也就是说使得每一个条件里面可能有多个「$x_i$ 为 `true`/`false`」的子句。此时得到的问题称作 CNF-SAT。

将 CNF-SAT 的条件进一步推广，「给定一个逻辑表达式，要求 $x_i$ 使得它为真」的问题叫做 C-SAT。

C-SAT 与 CNF-SAT 都是 NPC 的。所以我们一般只会研究 2-SAT。

## 习题

-   [洛谷 P5782 和平委员会](https://www.luogu.com.cn/problem/P5782)
-   [POJ3683 Priest John's Busiest Day](http://poj.org/problem?id=3683)
