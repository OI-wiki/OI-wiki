本页面将简要介绍模拟算法。

## 简介

模拟就是用计算机来模拟题目中要求的操作。

模拟题目通常具有码量大、操作多、思路繁复的特点。由于它码量大，经常会出现难以查错的情况，如果在考试中写错是相当浪费时间的。

## 技巧

写模拟题时，遵循以下的建议有可能会提升做题速度：

- 在动手写代码之前，在草纸上尽可能地写好要实现的流程。
- 在代码中，尽量把每个部分模块化，写成函数、结构体或类。
- 对于一些可能重复用到的概念，可以统一转化，方便处理：如，某题给你 "YY-MM-DD 时：分" 把它抽取到一个函数，处理成秒，会减少概念混淆。
- 调试时分块调试。模块化的好处就是可以方便的单独调某一部分。
- 写代码的时候一定要思路清晰，不要想到什么写什么，要按照落在纸上的步骤写。

实际上，上述步骤在解决其它类型的题目时也是很有帮助的。

## 例题详解

???+note " [Climbing Worm](https://vjudge.net/problem/Kattis-climbingworm)"
    一只长度不计的蠕虫位于 $n$ 英寸深的井的底部。它每次向上爬 $u$ 英寸，但是必须休息一次才能再次向上爬。在休息的时候，它滑落了 $d$ 英寸。之后它将重复向上爬和休息的过程。蠕虫爬出井口需要至少爬多少次？如果蠕虫爬完后刚好到达井的顶部，我们也设作蠕虫已经爬出井口。

??? note "解题思路"
    直接使用程序模拟蠕虫爬井的过程就可以了。用一个循环重复蠕虫的爬井过程，当攀爬的长度超过或者等于井的深度时跳出。

??? note "参考代码"
    ```cpp
    --8<-- "docs/basic/code/simulate/simulate_1.cpp"
    ```

???+note " [「SDOI2010」猪国杀 - LibreOJ](https://loj.ac/problem/2885)"
    **题目描述**
    
    **游戏背景**
    
    《猪国杀》是一种多猪牌类回合制游戏，一共有 $3$ 种角色：主猪，忠猪，反猪。每局游戏主猪有且只有 $1$ 只，忠猪和反猪可以有多只，每只猪扮演 $1$ 种角色。
    
    **游戏目的**
    
    主猪/$\texttt{MP}$：自己存活的情况下消灭所有的反猪。  
    忠猪/$\texttt{ZP}$：不惜一切保护主猪，胜利条件与主猪相同。  
    反猪/$\texttt{FP}$：杀死主猪。
    
    **游戏过程**
    
    游戏开始时，每个玩家手里都会有 $4$ 张牌，且体力上限和初始体力都是 $4$。
    
    开始游戏时，从主猪开始，按照逆时针方向（数据中就是按照编号从 $1 , 2, 3 \ldots n , 1 \ldots$ 的顺序）依次行动。
    
    每个玩家自己的回合可以分为 2 个阶段：
    
    - **摸牌阶段**：从牌堆顶部摸 $2$ 张牌，依次放到手牌的最右边；
    - **出牌阶段**：你可以使用任意张牌，每次使用牌的时候都使用最靠左的能够使用的牌。当然，要满足如下规则：
    
    1. 如果没有猪哥连弩，每个出牌阶段只能使用 $1$ 次「杀」来攻击；
    2. 任何牌被使用后被弃置（武器是装备上）；被弃置的牌以后都不能再用，即与游戏无关。
    
    **各种牌介绍**
    
    每张手牌用 $1$ 个字母表示，字母代表牌的种类。
    
    **基本牌**
    
    - 『桃/$\texttt{P}$』在自己的回合内，如果自己的体力值不等于体力上限，那么使用 $1$ 个桃可以为自己补充 $1$ 点体力，否则不能使用桃；桃只能对自己使用；在自己的回合外，如果自己的血变为 $0$ 或者更低，那么也可以使用。
    
    - 『杀/$\texttt{K}$』在自己的回合内，对攻击范围内除自己以外的 $1$ 名角色使用。如果没有被『闪』抵消，则造成 $1$ 点伤害。无论有无武器，杀的攻击范围都是 $1$。
    
    - 『闪/$\texttt{D}$』当你受到杀的攻击时，可以弃置 $1$ 张闪来抵消杀的效果。
    
    **锦囊牌**
    
    - 『决斗/$\texttt{F}$』出牌阶段，对除自己以外任意 $1$ 名角色使用，由目标角色先开始，自己和目标角色轮流弃置 $1$ 张杀，首先没有杀可弃的一方受到 $1$ 点伤害，另一方视为此伤害的来源。
    
    - 『南猪入侵/$\texttt{N}$』出牌阶段，对除你以外所有角色使用，按逆时针顺序从使用者下家开始依次结算，除非弃置 $1$ 张杀，否则受到 $1$ 点伤害。
    
    - 『万箭齐发/$\texttt{W}$』和南猪入侵类似，不过要弃置的不是杀而是闪。
    
    - 『无懈可击/$\texttt{J}$』在目标锦囊生效前抵消其效果。每次有 $1$ 张锦囊即将生效时，从使用这张锦囊的猪开始，按照逆时针顺序，依次得到使用无懈可击的机会；效果：用于决斗时，决斗无效并弃置；用于南猪入侵或万箭齐发时，当结算到某个角色时才能使用，当前角色不需弃置牌并且不会受到伤害（仅对 $1$ 个角色产生效果）；用于无懈可击时，成为目标的无懈可击被无效。
    
    **装备牌**
    
    - 『猪哥连弩/$\texttt{Z}$』武器，攻击范围 $1$，出牌阶段你可以使用任意张杀；同一时刻最多只能装 $1$ 把武器；如果先前已经有了 $1$ 把武器，那么之后再装武器的话，会弃置以前的武器来装现在的武器。
    
    **特殊事件及概念解释**
    
    - **伤害来源**：杀、南猪入侵、万箭齐发的伤害来源均是使用该牌的猪，决斗的伤害来源如上；
    
    - **距离**：两只猪的距离定义为沿着逆时针方向间隔的猪数 $+1$。即初始时 $1$ 和 $2$ 的距离为 $1$，但是 $2$ 和 $1$ 的距离就是 $n-1$。注意一个角色的死亡会导致一些猪距离的改变；
    
    - **玩家死亡**：如果该玩家的体力降到 $0$ 或者更低，并且自己手中没有足够的桃使得自己的体力值回到 $1$，那么就死亡了，死亡后所有的牌（装备区，手牌区）被弃置；
    
    - **奖励与惩罚**：反猪死亡时，最后一个伤害来源处（即使是反猪）立即摸 $3$ 张牌。忠猪死亡时，如果最后一个伤害来源是主猪，那么主猪所有装备牌、手牌被弃置。
    
    注意：一旦达成胜利条件，游戏立刻结束，因此即使会摸 $3$ 张牌或者还有牌可以用也不用执行了。
    
    现在，我们已经知道每只猪的角色、手牌，还有牌堆初始情况，并且假设每个角色会按照如下的行为准则进行游戏，你需要做的就是告诉小猪 iPig 最后的结果。
    
    **几种行为**
    
    - **献殷勤**：使用无懈可击挡下南猪入侵、万箭齐发、决斗；使用无懈可击抵消表敌意；
    - **表敌意**：对某个角色使用杀、决斗；使用无懈可击抵消献殷勤；
    - **跳忠**：即通过行动表示自己是忠猪。跳忠行动就是对主猪或对某只已经跳忠的猪献殷勤，或者对某只已经跳反的猪表敌意；
    - **跳反**：即通过行动表示自己是反猪。跳反行动就是对主猪或对某只已经跳忠的猪表敌意，或者对某只已经跳反的猪献殷勤。
    
    **注意：忠猪不会跳反，反猪也不会跳忠；不管是忠猪还是反猪，能够跳必然跳**。
    
    **行动准则**
    
    **共性**
    
    - 每个角色如果手里有桃且生命值未满，那么必然吃掉；
    - 有南猪入侵、万箭齐发、必然使用；有装备必然装上；
    - 受到杀时，有闪必然弃置；
    - 响应南猪入侵或者万箭齐发时候，有杀/闪必然弃置；
    - 不会对未表明身份的猪献殷勤（**包括自己**）。
    
    **特性**
    
    - 主猪：
    
    - 主猪会认为「没有跳身份，且用南猪入侵/万箭齐发对自己造成伤害的猪」是 **类** 反猪（没伤害到不算，注意类反猪并没有表明身份），如果之后跳了，那么主猪会重新认识这只猪；
    - 对于每种表敌意的方式，对逆时针方向能够执行到的第一只类反猪或者已跳反猪表；如果没有，那么就不表敌意；
    - 决斗时会不遗余力弃置杀；
    - 如果能对已经跳忠的猪或自己献殷勤，那么一定献；如果能够对已经跳反的猪表敌意，那么一定表。
    
    - 忠猪：
    
    - 对于每种表敌意的方式，对「逆时针方向能够执行到的第一只已经跳反的猪」表，如果没有，那么就不表敌意；
    - 决斗时，如果对方是主猪，那么不会弃置杀，否则，会不遗余力弃置杀；
    - 如果有机会对主猪或者已经跳忠的猪献殷勤，那么一定献。
    
    - 反猪：
    
    - 对于每种表敌意的方式，如果有机会则对主猪表，否则，对「逆时针方向能够执行到的第一只已经跳忠的猪」表，如果没有，那么就不表敌意；
    - 决斗时会不遗余力弃置杀；
    - 如果有机会对已经跳反的猪献殷勤，那么一定献。
    
    限于 iPig 只会用 P++ 语言写 A + B，他请你用 Pigcal (Pascal)、P (C) 或 P++ (C++) 语言来帮他预测最后的结果。

??? note "解题思路"
    模拟游戏过程即可。
    
    一些可能需要注意的地方：
    
    - 使用某些牌后，可能使它之前的手牌变得可用，所以使用手牌后，要从头扫描手牌。
    - 决斗可能会使正在进行回合的猪死亡，此时要赶紧返回，不能让已经死亡的猪继续使用手牌。
    - 忠猪面对来自主猪的决斗，会直接自残。
    - 寻找杀和决斗等的对象，要跳过已经死亡的猪。
    - 决斗、南猪、万箭的无懈询问是从出锦囊牌的猪开始的。

??? note "参考代码"
    ```cpp
    --8<-- "docs/basic/code/simulate/simulate_2.cpp"
    ```

## 习题

- [「NOIP2014」生活大爆炸版石头剪刀布 - Universal Online Judge](https://uoj.ac/problem/15)
- [「OpenJudge 3750」魔兽世界](http://bailian.openjudge.cn/practice/3750/)
- [「CSP-S 2020」儒略日 - LibreOJ](https://loj.ac/p/3379)
