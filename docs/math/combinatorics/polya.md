author: Wajov, c-forrest

前置知识：[置换和排列](../permutation.md)

## 引入

Polya 计数原理通常通常用来解决一些涉及「本质不同」的计数问题。

???+ info "本文可能涉及群论的相关内容"
    本文可能涉及到群论的相关内容。本文会对涉及到的群论概念做简单的解释，以便于不熟悉相关内容的读者理解和应用 Polya 计数原理。关于群论的内容，严格的表述和讨论请参考 [抽象代数基本概念](./basic.md)、[群论](./group-theory.md) 等章节。

## Burnside 引理

相关阅读：[Burnside 引理](../algebra/group-theory.md#burnside-引理)

Polya 计数原理是 Burnside 引理的应用和推广。在介绍 Polya 计数原理之前，需要先简单地回顾 Burnside 引理的内容。

为了总结出一般的规律，首先考虑简单的例子。

???+ note "项链染色"
    现在有一串共四个珠子的项链，每个珠子可以是红色或者蓝色，计算共有几种本质不同的珠子。（如果两种染色的结果可以通过旋转项链重合，就认为是相同的。)

??? note "解答和分析"
    这个问题足够简单，可以通过枚举的方式加以解答。珠子共计 $4$ 个，每个珠子可以染 $2$ 种颜色，所以，项链所有可能的染色方案共计 $2^4=16$ 种。将可以通过旋转相互得到的分到一组，共计 $6$ 组，如下图所示。

    从这个例子中可以看到，要计算本质不同的染色的种类数，关键其实是知道每种本质相同的染色对应几种不同的染色方案。也就是说，要搞清楚上图中每个分组的大小。

    能够分到同一个组中的染色方案，就是指它们之间能够通过旋转操作互相转化的染色方案。总共有 $4$ 种旋转的方式，即 

    $$
    G=\{r_0,r_1,r_2,r_3\},
    $$

    分别表示旋转 $0,1,2,3$ 次。旋转 $0$ 次就是原地不动。

    首先看染色方案 $RRBB$ 所在的分组。对它施加这四种操作，将分别得到 

    $$
    RRBB, RBBR, BBRR, BRRB.
    $$

    四种染色方案互不相同，因此这个组就有 $4$ 个元素。

    再看染色方案 $BRBR$ 所在的分组。对它同样施加这四种操作，将分别得到 

    $$
    BRBR, RBRB, BRBR, RBRB.
    $$

    此时，旋转两次的结果和不旋转的结果是一致的，旋转三次和旋转一次的结果是一致的。所以，这个组就有 $2$ 个元素。

    如果看染色方案 $BBBB$ 和 $RRRR$ 所在的分组。对它们施加四种操作得到的结果都是它们自身。因而，每个组就只有 $1$ 个元素。

    如果用 $x$ 表示染色方案，$Gx$ 表示对染色方案 $x$ 操作后能够得到的颜色编码的集合，那么从上面的例子可以总结出一个规律，那就是 $G$ 的操作对于 $x$ 的影响存在某种「周期性」。

    设 $|G|$ 表示操作的总个数，这种影响的「周期性」意味着，如果有 $m$ 个不同的 $G$ 中的操作将染色方案 $x$ 变换到它自身，那么 $x$ 在这些操作下的结果就会重复出现 $m$ 次。因而，染色方案 $x$ 在这些操作下共计有 $|G|/m$ 种不同的结果，这也就是 $x$ 所在分组的大小。

    这个例子中，因为只有旋转零次 $r_0$ 才能够将 $RRBB$ 变换到它自身，所以，它所在分组的大小等于 $4/1=4$；而旋转零次 $r_0$ 和两次 $r_2$ 都能将 $BRBR$ 变换到它自身，所以，它所在分组的大小等于 $4/2=2$；无论旋转几次都能将 $BBBB$ 变换到它自身，所以，它所在分组的大小就是 $4/4=1$。

    在下面的叙述中，用 $G_x$ 表示能够将 $x$ 变换到它自身的操作的数目，所以，$|G_x|$ 就是上面的 $m$。此时，$X$ 所在分组大小是 $|G|/|G_x|$。要计算染色方案的分组的数目，只需要穷举所有可能的染色方案 $x\in X$，对所在分组大小为 $|Gx|$ 的染色方案 $x$ 赋以权重 $1/|Gx|$，就能够将分组的数目表达为

    $$
    |X/G|=\sum_{x\in X}\frac{1}{|Gx|}=\sum_{x\in X}\frac{|G_x|}{|G|}.
    $$

    现在这个式子的形式并不便于应用。记 $gx$ 是对染色方案 $x\in X$ 应用操作 $g\in G$ 的结果，那么上面描述的集合 $G_x$ 就是 $\{g\in G:gx=x\}$，所以交换求和顺序就有 

    $$
    \begin{aligned}
    \sum_{x\in X}|G_x| 
    &=\sum_{x\in X}|\{g\in G:gx=x\}|\\
    &=\sum_{x\in X}\sum_{g\in G}[gx=x]\\
    &=\sum_{g\in G}\sum_{x\in X}[gx=x]\\
    &=\sum_{g\in G}|\{x\in X:gx=x\}|\\
    &=\sum_{g\in G}|X^g|.
    \end{aligned}
    $$

    这里，$[\cdot]$ 称为 [Iverson 括号](https://mathworld.wolfram.com/IversonBracket.html)，只有当命题 $P$ 为真时 $[P]$ 取值为 $1$，否则取 $0$。交换求和记号的结果中，$X^g=\{x\in X:gx=x\}$ 是指在操作 $g$ 下保持不变的染色方案 $x$ 的集合。简言之，它是操作 $g$ 的不动点。

    在这些讨论之后，现在可以将分组的个数写作

    $$
    |X/G|=\frac{1}{|G|}\sum_{g\in G}|X^g|.
    $$

    也就是说，分组的个数是各种旋转操作的不动点的平均个数。

    作为这个结果的应用，再次计算项链染色的个数。这些旋转操作的不动点可以列举如下。

    | 操作 | 不动点 |
    |:----:|:-------:|
    | $r_0$ | $X$ |
    | $r_1$ | $\{BBBB,RRRR\}$ | 
    | $r_2$ | $\{BBBB,BRBR,RBRB,RRRR\}$ | 
    | $r_3$ | $\{BBBB,RRRR\}$ | 

    因而，分组的个数就等于 

    $$
    \frac{16+2+4+2}{4} = 6.
    $$

    这样就得到了前面的结果。

从这个例子中，可以归纳出一般的结果，用于求解这类计数问题。为了方便讨论，本文考虑的情景是染色问题，当然也可以应用到别的情景上去，在文末会提供相应的例子。

染色问题是说，给定某个结构，在它的每个顶点上染色，会得到不同的染色方案。这个结构拥有某种对称性，使得看似不同的染色方案在经过一系列对称操作后能够互相转化。这些能互相转化的染色方案就称为本质相同的。问题是要求解本质不同的染色的数目。

根据例子中的分析，要求解这样的问题，首先要讨论给定的结构都有哪些对称操作。这些对称操作的集合 $G$ 称为给定结构的空间对称群。实际应用中，无需了解群的定义，只需要能够不重不漏地讨论所有的空间对称操作就可以了。

所有染色方案的集合记作 $X$，其中的单个染色方案记作 $x$。操作 $g\in G$ 作用在染色方案 $x\in X$ 的结果是 $gx$。那么，能够通过某个操作作用在染色方案 $x$ 上的所有结果就是 $Gx=\{gx:g\in G\}$，它称为群 $G$ 作用下 $x$ 的轨道。同一轨道中的不同染色方案就是这类问题中所谓「本质相同」的。故而，所有本质不同的染色的数目，就等价于不同轨道的数目。

例子中的分析可以推广到一般的情形。

???+ note "Burnside 引理"
    给定群 $G$ 在集合 $X$ 上的作用，则所有不同的轨道的数目
    
    $$
    |X/G|=\frac{1}{|G|}\sum_{g\in G}|X^g|.
    $$
    
    这里，$X^g=\{x\in X:gx=x\}$ 是 $g\in G$ 的作用下的不动点集合。

它的证明几乎就是照搬上面例子中的分析。但是，例子中用到了观察，即群 $G$ 在单个元素 $x$ 上的作用结果具有某种「周期性」，所以，这种周期重复的数目就等于能将 $x$ 变换到它自身的操作的数目。这个观察在一般的情形是正确的，但是因为群 $G$ 的结构可能很复杂，它的「周期性」未必是例子中呈现的那么直接。这个结论称作 [轨道稳定子定理（orbit-stabilizer theorem）](../algebra/group-theory.md#稳定化子)。

在应用的时候，只要能够列举出所有的对称操作，并且给出每个对称操作对应的不动点数目就可以解决对应的计数问题。下面是一个稍微复杂的应用。

???+ note "立方体染色"
    用三种颜色给一个立方体染色，求本质不同的方案数（经过空间旋转后相同的两种方案视为同一种）。

??? note "解答"
    因为立方体有 $6$ 个面，每个面有 $3$ 中染色方法，所以，总共有 $3^6$ 种染色方案，即 $|X|=3^6$。记立方体的空间对称群为 $G$。

    ![](../images/cube.png)

    接下来我们需要对 $G$ 中的所有操作进行分析，它们可以分为以下几类（方便起见，将立方体的六个面分别称为前、后、上、下、左、右）：

    -   不动：即恒等变换，因为所有直接染色方案经过恒等变换都不变，因此它对应的 $|X^g|=3^6$；
    -   以两个相对面的中心连线为轴的 $90^\circ$ 旋转：相对面有 $3$ 种选择，旋转的方向有 $2$ 种选择，因此这类共有 $6$ 个置换。假设选择了前、后两个面中心的连线为轴，则必须要满足上、下、左、右四个面的颜色一样，才能使旋转后不变。此时，有 $3$ 个可以自由染色的区域，因此它对应的 $|X^g|=3^3$；
    -   以两个相对面的中心连线为轴的 $180^\circ$ 旋转：相对面有 $3$ 种选择，旋转方向的选择没有影响，因此这类共有 $3$ 个置换。假设选择了前、后两个面中心的连线为轴，则必须要满足上、下两个面的颜色一样，左、右两个面的颜色一样，才能使旋转后不变。此时，有 $4$ 个可以自由染色的区域，因此它对应的 $|X^g|=3^4$；
    -   以两条相对棱的中点连线为轴的 $180^\circ$ 旋转：相对棱有 $6$ 种选择，旋转方向对置换依然没有影响，因此这类共有 $6$ 个置换。假设选择了前、上两个面的边界和下、后两个面的边界作为相对棱，则必须要满足前、上两个面的颜色一样，下、后两个面的颜色一样，左、右两个面的颜色一样，才能使旋转后不变。此时，有 $3$ 个可以自由染色的区域，因此它对应的 $|X^g|=3^3$；
    -   以两个相对顶点的连线为轴的 $120^\circ$ 旋转：相对顶点有 $4$ 种选择，旋转的方向有 $2$ 种选择，因此这类共有 $8$ 个置换。假设选择了前面的右上角和后面的左下角作为相对顶点，则必须满足前、上、右三个面的颜色一样，后、下、左三个面的颜色一样，才能使旋转后不变。此时，有 $2$ 个可以自由染色的区域，因此它对应的 $|X^g|=3^2$。

    因此，所有本质不同的染色方案数为

    $$
    \frac{1\times3^6+6\times3^3+3\times3^4+6\times3^3+8\times3^2}{1+6+3+6+8}=57.
    $$

## Pólya 定理

### 定义

在与 Burnside 引理相同的前置条件下，
若 $X$ 为 **所有** 从 $A$ 到 $B$ 的映射，内容修改为

$$
|X/G|=\frac{1}{|G|}\sum_{g\in G}|B|^{c(g)}
$$

其中 $c(g)$ 表示置换 $g$ 能拆分成的不相交的循环置换的数量。

### 解释

依然考虑立方体染色问题。分析刚才提到的以相对棱的中点连线为轴的 $180^\circ$ 旋转，如果将前、后、上、下、左、右 6 个面依次编号为 1 到 6，则该置换可以表示为（翻转后原来编号为 1 的面的位置变为了编号为 3 的面，以此类推）

$$
\begin{pmatrix}1,3,2,4,5,6\\
3,1,4,2,6,5\end{pmatrix}=(1,3)\circ(2,4)\circ(5,6)
$$

因此 $c(g)=3,|B|^{c(g)}=3^3$，与刚才在 Burnside 引理中分析的结果相同。

### 证明

在 Burnside 引理中，显然 $g(x)=x$ 的充要条件是 $x$ 将 $g$ 中每个循环置换的元素都映射到了 $B$ 中的同一元素，所以 $|X^g|=|B|^{c(g)}$，即可得 Pólya 定理。
