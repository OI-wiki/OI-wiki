## Pell 方程

我们给出两个不定方程：$x-dy^{2}=1$ 和 $x-dy^{2}=-1$，若 $d$ 为完全平方数，则第一个方程只有解 $(\pm1,0)$，第二个方程无解。若 $d$ 不为完全平方数，设 $\xi_{0}=\sqrt{d}$，设它的循环连分数周期为 $l$，渐近分数为 $\frac{p_{n}}{q_{n}}$，则：

- 当 $l$ 为偶数时，第一个方程的全体正解为 $x=p_{jl-1},y=q_{jl-1},j=1,2,3,\cdots$，第二个方程无解。
- 当 $l$ 为奇数时，第一个方程的全体正解为 $x=p_{jl-1},y=q_{jl-1},j=2,4,6,\cdots$，第二个方程的全体正解为 $x=p_{jl-1},y=q_{jl-1},j=1,3,5,\cdots$。

还有另一种更加简单的表示方法：

- 当 $l$ 为偶数时，第一个方程的全体解为 $x+y\sqrt{d}=\pm(p_{l-1}\pm q_{l-1}\sqrt{d})^{j},j=0,1,2,\cdots$，第二个方程无解。
- 当 $l$ 为奇数时，第一个方程的全体正解为 $x+y\sqrt{d}=\pm(p_{l-1}\pm q_{l-1}\sqrt{d})^{j},j=0,2,4,\cdots$，第二个方程的全体正解为 $x+y\sqrt{d}=\pm(p_{l-1}\pm q_{l-1}\sqrt{d})^{j},j=1,3,5,\cdots$。

这就是典型的循环连分数渐进分数与二次有理数乘法的对应关系。

对于 $d$ 为 $4k+1$ 形式的时候，有可能相应基本单位数的系数是半整数。此时有结论：如果 $d$ 为 $4k+1$ 形式时，相应基本单位数的系数是半整数，则基本单位数的三次方系数为整数。

此时，上述方法求出的基本解不是基本单位数，而是基本单位数的三次方。

如果想直接求解 $d$ 为 $4k+1$ 形式时的基本单位数，改令 $\xi_{0}=\frac{\sqrt{d}}{2}$，并规定这里的连分数第零项为半整数，重复上述操作，并将结果乘 $2$（提出二分之一）。

例如当 $d$ 为 $5$ 的时候，$\frac{\sqrt{5}}{2}$ 的半整数连分数表示为：

$$
\frac{\sqrt{5}}{2}=[\frac{1}{2},\overline{1}]
$$

$$
\frac{1}{2}=\frac{1}{2}\frac{1}{1}
$$

于是解得基本单位数 $\frac{1}{2}+\frac{\sqrt{5}}{2}$。

但是 $d$ 为 $17$ 的时候，$\frac{\sqrt{17}}{2}$ 的半整数连分数表示为：

$$
\frac{\sqrt{17}}{2}=[\frac{3}{2},\overline{1,1,3}]
$$

$$
\frac{3}{2}+\frac{1}{1+\frac{1}{1}}=\frac{3}{2}+\frac{1}{2}=\frac{1}{2}\frac{4}{1}
$$

于是解得基本单位数 $4+\sqrt{17}$。它不属于半整数形式。

在 $1$ 到 $100$ 中，$5$，$13$，$29$，$53$，$61$ 和 $85$ 的基本单位数属于这种分母中含 $2$ 的半整数形式，而 $17$，$37$，$41$，$65$，$73$，$89$ 和 $97$ 的基本单位数属于非半整数形式。

如果快速求解第 $n$ 个解（或第 $n$ 个单位数），只需要求出基本解（或基本单位数），然后借助快速幂的想法去乘就可以了。注意乘一个二次有理数的时候，$a$ 与 $b$ 的变化是一个递推关系。

如果要求从头开始连续若干个解（或连续若干个单位数），$a$ 与 $b$ 的变化就是一个固定的递推关系，相邻三项一定满足特征方程，即基本解（或基本单位数）对应的二次三项式。即：

如果基本解（或基本单位数）$a+b\sqrt{d}$ 是对应的二次方程 $x^2+px+q=0$ 的解，则有递推：

$$
a_n+pa_{n-1}+qa_{n-2}=0\\
b_n+pb_{n-1}+qb_{n-2}=0
$$

事实上，[斐波那契数列](../fibonacci.md)（的一半）与卢卡斯数列（的一半）恰好组合成了基本单位数 $\frac{1}{2}+\frac{1}{2}\sqrt{5}$ 的全体幂，即使引入负下标也成立。这是它们的很多性质的来源。
