name: Remove Labels on PR Merge

on:
  pull_request:
    types: [closed]

permissions:
  issues: write
  pull-requests: write

jobs:
  remove-labels:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const labelsRemoved = [
              'More details needed / ÂÜÖÂÆπÈúÄÂ¢û‰øÆ',
              'Need Processing / ÈúÄË¶ÅÂ§ÑÁêÜ',
              'Pending apply suggestions / Á≠âÂæÖÈááÁ∫≥Âª∫ËÆÆ',
              'Pending merge / Á≠âÂæÖÂêàÂπ∂',
              'Pending review / Á≠âÂæÖÂÆ°Ê†∏',
              'Waiting other PRs / Á≠âÂæÖÂÖ∂ÂÆÉ PR',
              'Á≠âÂæÖÂèñÊ∂à‰øÆÊîπËØ∑Ê±Ç / Pending Cancel Changes Request',
              'Awaiting Review / PR ÂæÖÂêà',
              'Busy Author / ‰ΩúËÄÖÊ≠£Âøô',
              'Discussion / ÈúÄË¶ÅËÆ®ËÆ∫',
              'Fix in progress / Ê≠£Âú®‰øÆÈîÖ',
              'Format fix needed / Ê†ºÂºèÈúÄ‰øÆÊ≠£',
              'Help needed for format / ÈúÄË¶ÅÂ∏ÆÂä©‰øÆÊ≠£Ê†ºÂºè',
              'help wanted / ÈúÄË¶ÅÂ∏ÆÂä©',
            ];
            const pr = context.payload.pull_request;
            const labels = pr.labels.map(label => label.name);
            const found = labelsRemoved.filter(label => labels.includes(label));
            if (found.length > 0) {
              core.info(`üïí Removing labels: ${found.join(', ')}`);
              for (const label of found) {
                try {
                  await github.rest.issues.removeLabel({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: pr.number,
                    name: label
                  });
                  core.info(`‚úÖ Remove label: ${label}`);
                } catch (error) {
                  core.warning(`‚ö†Ô∏è Failed to remove label ${label}: ${error.message}`);
                }
              }
            } else {
              core.info('‚úÖ No target labels to remove');
            }
